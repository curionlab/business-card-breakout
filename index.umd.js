!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).BusinessCardBreakout={})}(this,function(t){"use strict";var e=Object.defineProperty,i=(t,i,s)=>((t,i,s)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s)(t,"symbol"!=typeof i?i+"":i,s);class s{constructor(t,e,s,a=6){i(this,"ball"),i(this,"baseSpeed"),this.ball={x:t,y:e,vx:0,vy:0,radius:s},this.baseSpeed=a}getBall(){return this.ball}update(){this.ball.x+=this.ball.vx,this.ball.y+=this.ball.vy;const t=Math.sqrt(this.ball.vx*this.ball.vx+this.ball.vy*this.ball.vy);if(t<this.baseSpeed&&t>0){const e=this.baseSpeed/t;this.ball.vx*=e,this.ball.vy*=e}}setVelocity(t,e){this.ball.vx=t,this.ball.vy=e}checkWallCollision(t,e){this.ball.x-this.ball.radius<0&&(this.ball.x=this.ball.radius,this.ball.vx=Math.abs(this.ball.vx)),this.ball.x+this.ball.radius>t&&(this.ball.x=t-this.ball.radius,this.ball.vx=-Math.abs(this.ball.vx)),this.ball.y-this.ball.radius<0&&(this.ball.y=this.ball.radius,this.ball.vy=Math.abs(this.ball.vy))}reset(t,e){this.ball.x=t,this.ball.y=e,this.ball.vx=0,this.ball.vy=0}checkPaddleCollision(t,e,i,s){if(this.ball.y+this.ball.radius>=e&&this.ball.y-this.ball.radius<=e+s&&this.ball.x+this.ball.radius>=t&&this.ball.x-this.ball.radius<=t+i){const s=((this.ball.x-t)/i-.5)*Math.PI*.7;return this.ball.vx=Math.sin(s)*this.baseSpeed,this.ball.vy=-Math.abs(Math.cos(s)*this.baseSpeed),this.ball.y=e-this.ball.radius,!0}return!1}checkBlockCollision(t,e,i,s){const a=Math.max(t,Math.min(this.ball.x,t+i)),l=Math.max(e,Math.min(this.ball.y,e+s)),h=this.ball.x-a,n=this.ball.y-l,o=h*h+n*n;if(o<this.ball.radius*this.ball.radius){const t=Math.sqrt(o),e=t>0?h/t:0,i=t>0?n/t:0,s=this.ball.radius-t;this.ball.x+=e*s,this.ball.y+=i*s;const a=this.ball.vx*e+this.ball.vy*i;return this.ball.vx=this.ball.vx-2*a*e,this.ball.vy=this.ball.vy-2*a*i,{collided:!0,normal:{x:e,y:i}}}return{collided:!1,normal:{x:0,y:0}}}}class a{constructor(t,e,s,a,l=8){i(this,"paddle"),i(this,"keysPressed",new Map),i(this,"lastKeyPressTime",0),this.paddle={x:t,y:e,width:s,height:a,vx:0},this.setupKeyListeners()}getPaddle(){return this.paddle}getWidth(){return this.paddle.width}setupKeyListeners(){"undefined"!=typeof window&&(window.addEventListener("keydown",t=>{const e=t.key.toLowerCase();this.keysPressed.set(e,!0),"arrowleft"!==e&&"arrowright"!==e&&"a"!==e&&"d"!==e||(this.lastKeyPressTime=performance.now())}),window.addEventListener("keyup",t=>{this.keysPressed.set(t.key.toLowerCase(),!1)}))}isKeyboardActive(){return performance.now()-this.lastKeyPressTime<500}update(t,e){this.paddle.vx=0,(this.keysPressed.get("arrowleft")||this.keysPressed.get("a"))&&(this.paddle.vx=-e,this.lastKeyPressTime=performance.now()),(this.keysPressed.get("arrowright")||this.keysPressed.get("d"))&&(this.paddle.vx=e,this.lastKeyPressTime=performance.now()),this.paddle.x+=this.paddle.vx,this.paddle.x<0&&(this.paddle.x=0),this.paddle.x+this.paddle.width>t&&(this.paddle.x=t-this.paddle.width)}updateFromPointer(t,e){const i=t-this.paddle.width/2;this.paddle.x=Math.max(0,Math.min(i,e-this.paddle.width))}reset(t,e){this.paddle.x=t,this.paddle.y=e,this.paddle.vx=0}}class l{constructor(t=5e3,e=1e3,s=1,a={}){i(this,"blocks",[]),i(this,"blockRecoveryTime"),i(this,"blockFadeInTime"),i(this,"dpr",1),i(this,"elementColors"),this.blockRecoveryTime=t,this.blockFadeInTime=e,this.dpr=s,this.elementColors=a}getBlocks(){return this.blocks}calculateFontSize(t,e,i=16){const s=e*t*this.dpr;return Math.max(Math.round(s),i)}calculateCanvasSize(t,e){const i=e*t*this.dpr;return Math.round(i)}drawTextFitToWidth(t,e,i,s,a,l,h,n="left"){t.font=`${l}px ${h}`;const o=t.measureText(e).width;if(o<=a)return t.textAlign=n,t.fillText(e,i,s),l;const r=a/o;t.save();const c=i/r;return t.scale(r,1),t.textAlign=n,t.fillText(e,c,s),t.restore(),l}getFontFamily(t){const e=/[\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]/.test(t),i=/[\u4E00-\u9FFF]/.test(t)&&!e,s=/[\uAC00-\uD7AF\u1100-\u11FF]/.test(t),a=/[\u0E00-\u0E7F]/.test(t),l=/[\u0600-\u06FF]/.test(t),h=/[\u0400-\u04FF]/.test(t);return e?'"DotGothic16", monospace':i?'"ZCOOL QingKe HuangYou", "Noto Sans SC", sans-serif':s?'"Noto Sans KR", sans-serif':a?'"Noto Sans Thai", sans-serif':l?'"Noto Sans Arabic", sans-serif':h?'"Silkscreen", "Press Start 2P", monospace':'"Bitcount Prop Single", "DotGothic16", monospace'}createStandardLayout(t,e,i,s){const a=document.createElement("canvas"),l=a.getContext("2d",{willReadFrequently:!0});if(!l)return;l.imageSmoothingEnabled=!0;const h=this.calculateCanvasSize(.08,i),n=this.calculateCanvasSize(.85,e),o=this.calculateCanvasSize(.81,i);a.width=n,a.height=o,l.imageSmoothingEnabled=!0,l.clearRect(0,0,a.width,a.height),l.fillStyle="#FFFFFF";let r=h;const c=[];if(t.name){const e=this.calculateFontSize(.095,i,16),s=r,a=this.getFontFamily(t.name),o=n-2*h;l.textBaseline="top";const d=this.drawTextFitToWidth(l,t.name,h,r,o,e,a,"left");c.push({start:s,end:s+d,type:"name"}),r+=1.5*d}if(t.title){const e=this.calculateFontSize(.055,i,16),s=r,a=this.getFontFamily(t.title),o=n-2*h;l.textBaseline="top";const d=this.drawTextFitToWidth(l,t.title,h,r,o,e,a,"left");c.push({start:s,end:s+d,type:"title"}),r+=1.6*d}if(t.company){const e=this.calculateFontSize(.065,i,16),s=r,a=this.getFontFamily(t.company),o=n-2*h;l.textBaseline="top";const d=this.drawTextFitToWidth(l,t.company,h,r,o,e,a,"left");c.push({start:s,end:s+d,type:"company"}),r+=1.8*d}const d=this.calculateFontSize(.04,i,16),m=n-2*h;l.textBaseline="top",[{data:t.email,type:"email"},{data:t.phone,type:"phone"},{data:t.sns,type:"sns"},{data:t.website,type:"website"}].forEach(t=>{if(t.data){const e=r,i=this.getFontFamily(t.data),s=this.drawTextFitToWidth(l,t.data,h,r,m,d,i,"left");c.push({start:e,end:e+s,type:t.type}),r+=1.4*s}}),this.generateBlocksFromCanvas(a,e,i,s,c,{company:this.elementColors.company||"#60A5FA",name:this.elementColors.name||"#FF6B8A",title:this.elementColors.titleEn||"#A78BFA",email:this.elementColors.email||"#34D399",phone:this.elementColors.phone||"#FB923C",sns:this.elementColors.sns||"#F472B6",website:this.elementColors.website||"#FBBF24"},1)}createProfessionalLayout(t,e,i,s){const a=document.createElement("canvas"),l=a.getContext("2d",{willReadFrequently:!0});if(!l)return;l.imageSmoothingEnabled=!0;const h=this.calculateCanvasSize(.08,i),n=this.calculateCanvasSize(.85,e),o=this.calculateCanvasSize(.81,i);a.width=n,a.height=o,l.imageSmoothingEnabled=!0,l.clearRect(0,0,a.width,a.height),l.fillStyle="#FFFFFF";let r=h;const c=[];if(t.company){const e=this.calculateFontSize(.08,i,12),s=r,a=this.getFontFamily(t.company),o=n-2*h;l.textBaseline="top";const d=this.drawTextFitToWidth(l,t.company,n/2,r,o,e,a,"center");c.push({start:s,end:s+d,type:"company"}),r+=1.3*d}if(t.tagline){const e=this.calculateFontSize(.035,i,16),s=r,a=this.getFontFamily(t.tagline),o=n-2*h;l.textBaseline="top";const d=this.drawTextFitToWidth(l,t.tagline,n/2,r,o,e,a,"center");c.push({start:s,end:s+d,type:"tagline"}),r+=2*d}if(t.name){const e=this.calculateFontSize(.11,i,16),s=r,a=this.getFontFamily(t.name),o=n-2*h;l.textBaseline="top";const d=this.drawTextFitToWidth(l,t.name,h,r,o,e,a,"left");c.push({start:s,end:s+d,type:"name"}),r+=1.4*d}if(t.nameEn){const e=this.calculateFontSize(.05,i,16),s=r,a=this.getFontFamily(t.nameEn),o=n-2*h;l.textBaseline="top";const d=this.drawTextFitToWidth(l,t.nameEn,h,r,o,e,a,"left");c.push({start:s,end:s+d,type:"nameEn"}),r+=1.5*d}if(t.title){const e=this.calculateFontSize(.048,i,16),s=r,a=this.getFontFamily(t.title),o=n-2*h;l.textBaseline="top";const d=this.drawTextFitToWidth(l,t.title,h,r,o,e,a,"left");c.push({start:s,end:s+d,type:"title"}),r+=2*d}const d=this.calculateFontSize(.038,i,16);[{label:"Email",data:t.email,type:"email"},{label:"Phone",data:t.phone,type:"phone"},{label:"SNS",data:t.sns,type:"sns"},{label:"Website",data:t.website,type:"website"}].forEach(t=>{if(t.data){const e=r,i=this.getFontFamily(t.label),s=this.getFontFamily(t.data);l.textBaseline="top";const a=n-2*h,o=.15*a,m=.02*a,g=a-o-m,p=this.drawTextFitToWidth(l,t.label,h,r,o,d,i,"left"),u=h+o+m,x=this.drawTextFitToWidth(l,t.data,u,r,g,d,s,"left"),y=Math.max(p,x);c.push({start:e,end:e+y,type:t.type}),r+=1.4*y}}),this.generateBlocksFromCanvas(a,e,i,s,c,{company:this.elementColors.company||"#60A5FA",tagline:this.elementColors.tagline||"#A78BFA",name:this.elementColors.name||"#FF6B8A",nameEn:this.elementColors.nameEn||"#4ECDC4",title:this.elementColors.titleEn||"#A78BFA",email:this.elementColors.email||"#34D399",phone:this.elementColors.phone||"#FB923C",sns:this.elementColors.sns||"#F472B6",website:this.elementColors.website||"#FBBF24"},1)}createMinimalLayout(t,e,i,s){const a=document.createElement("canvas"),l=a.getContext("2d",{willReadFrequently:!0});if(!l)return;l.imageSmoothingEnabled=!0;const h=this.calculateCanvasSize(.08,i),n=this.calculateCanvasSize(.8,e),o=this.calculateCanvasSize(.81,i);a.width=n,a.height=o,l.imageSmoothingEnabled=!0,l.clearRect(0,0,a.width,a.height),l.fillStyle="#FFFFFF";let r=h;const c=[];if(t.name){const e=this.calculateFontSize(.12,i,16),s=r,a=this.getFontFamily(t.name),o=n-2*h;l.textBaseline="top";const d=this.drawTextFitToWidth(l,t.name,n/2,r,o,e,a,"center");c.push({start:s,end:s+d,type:"name"}),r+=1.6*d}const d=[t.title,t.company].filter(Boolean).join(" | ");if(d){const t=this.calculateFontSize(.045,i,16),e=r,s=this.getFontFamily(d),a=n-2*h;l.textBaseline="top";const o=this.drawTextFitToWidth(l,d,n/2,r,a,t,s,"center");c.push({start:e,end:e+o,type:"title"}),r+=2.5*o}const m=this.calculateFontSize(.035,i,16),g=n-2*h;l.textBaseline="top",[{data:t.email,type:"email"},{data:t.phone,type:"phone"},{data:t.sns,type:"sns"},{data:t.website,type:"website"}].forEach(t=>{if(t.data){const e=r,i=this.getFontFamily(t.data),s=this.drawTextFitToWidth(l,t.data,n/2,r,g,m,i,"center");c.push({start:e,end:e+s,type:t.type}),r+=1.6*s}}),this.generateBlocksFromCanvas(a,e,i,s,c,{name:this.elementColors.name||"#FF6B8A",title:this.elementColors.titleEn||"#A78BFA",email:this.elementColors.email||"#34D399",phone:this.elementColors.phone||"#FB923C",sns:this.elementColors.sns||"#F472B6",website:this.elementColors.website||"#FBBF24"},1)}createBlocksFromBusinessCard(t,e,i,s=1,a="standard"){switch(this.blocks=[],a){case"standard":this.createStandardLayout(t,e,i,s);break;case"professional":this.createProfessionalLayout(t,e,i,s);break;case"minimal":this.createMinimalLayout(t,e,i,s)}}generateBlocksFromCanvas(t,e,i,s,a,l,h=1){const n=t.getContext("2d");if(!n)return;const o=n.getImageData(0,0,t.width,t.height).data,r=1/this.dpr,c=(e-t.width*r)/2,d=(i-t.height*r)/2,m=t=>{for(const i of a)if(t>=i.start&&t<=i.end)return l[i.type]||"#FFFFFF";const e=a.reduce((e,i)=>{const s=(i.start+i.end)/2,a=Math.abs(t-s),l=(e.start+e.end)/2;return a<Math.abs(t-l)?i:e},a[0]);return l[null==e?void 0:e.type]||"#FFFFFF"},g=s,p=h;for(let u=0;u<t.height;u+=g)for(let e=0;e<t.width;e+=g){if(o[4*(u*t.width+e)+3]>80){const t=e*r,i=u*r;this.blocks.push({x:Math.round(c+t),y:Math.round(d+i),width:p,height:p,text:"",isDestroyed:!1,destroyedAt:0,color:m(u),fontSize:0,fontFamily:""})}}}destroyBlock(t,e){return t>=0&&t<this.blocks.length&&!this.blocks[t].isDestroyed&&(this.blocks[t].isDestroyed=!0,this.blocks[t].destroyedAt=e,!0)}getBlockRecoveryState(t,e){if(!t.isDestroyed)return{isDestroyed:!1,alpha:1};const i=e-t.destroyedAt;if(i<this.blockRecoveryTime)return{isDestroyed:!0,alpha:0};const s=i-this.blockRecoveryTime;if(s<this.blockFadeInTime){return{isDestroyed:!1,alpha:s/this.blockFadeInTime}}return{isDestroyed:!1,alpha:1}}updateBlockRecovery(t){this.blocks.forEach(e=>{if(e.isDestroyed){t-e.destroyedAt>=this.blockRecoveryTime+this.blockFadeInTime&&(e.isDestroyed=!1)}})}checkCollision(t,e,i){for(let s=0;s<this.blocks.length;s++){const a=this.blocks[s];if(a.isDestroyed)continue;const l=t-Math.max(a.x,Math.min(t,a.x+a.width)),h=e-Math.max(a.y,Math.min(e,a.y+a.height));if(l*l+h*h<i*i)return s}return-1}allBlocksDestroyed(){return this.blocks.every(t=>t.isDestroyed)}reset(){this.blocks.forEach(t=>{t.isDestroyed=!1,t.destroyedAt=0})}setBlockRecoveryTime(t){this.blockRecoveryTime=t}setBlockFadeInTime(t){this.blockFadeInTime=t}}class h{constructor(){i(this,"particles",[])}getParticles(){return this.particles}createBlockDestructionEffect(t,e,i,s=12){for(let a=0;a<s;a++){const l=a/s*Math.PI*2,h=3+4*Math.random(),n=Math.cos(l)*h,o=Math.sin(l)*h;this.particles.push({x:t,y:e,vx:n,vy:o,life:1,maxLife:1,color:i,size:4+4*Math.random()})}}createImpactEffect(t,e,i,s=8){for(let a=0;a<s;a++){const l=a/s*Math.PI*2+.5*(Math.random()-.5),h=2+3*Math.random(),n=Math.cos(l)*h,o=Math.sin(l)*h;this.particles.push({x:t,y:e,vx:n,vy:o,life:1,maxLife:1,color:i,size:2+3*Math.random()})}}update(){this.particles=this.particles.filter(t=>(t.life-=.05,t.x+=t.vx,t.y+=t.vy,t.vy+=.2,t.vx*=.98,t.life>0))}clear(){this.particles=[]}}class n{constructor(t,e=1){i(this,"ctx");const s=t.getContext("2d");if(!s)throw new Error("Failed to get 2D context from canvas");this.ctx=s,this.ctx.scale(e,e)}drawBackground(t,e){const i=this.ctx.createLinearGradient(0,0,0,e);i.addColorStop(0,"#1a1a2e"),i.addColorStop(1,"#16213e"),this.ctx.fillStyle=i,this.ctx.fillRect(0,0,t,e)}drawBlocks(t,e,i){t.forEach(t=>{const s=i.getBlockRecoveryState(t,e);if(!s.isDestroyed||0!==s.alpha){if(this.ctx.save(),this.ctx.globalAlpha=s.alpha,this.ctx.fillStyle=t.color,this.ctx.fillRect(t.x,t.y,t.width,t.height),t.text&&0!==t.text.length){this.ctx.strokeStyle=`rgba(255, 255, 255, ${.3*s.alpha})`,this.ctx.lineWidth=2,this.ctx.strokeRect(t.x,t.y,t.width,t.height);const e=this.ctx.createLinearGradient(t.x,t.y,t.x,t.y+t.height);e.addColorStop(0,`rgba(255, 255, 255, ${.2*s.alpha})`),e.addColorStop(.5,"rgba(255, 255, 255, 0)"),e.addColorStop(1,`rgba(0, 0, 0, ${.1*s.alpha})`),this.ctx.fillStyle=e,this.ctx.fillRect(t.x,t.y,t.width,t.height),this.ctx.fillStyle="#ffffff",this.ctx.font=`bold ${t.fontSize}px ${t.fontFamily}`,this.ctx.textAlign="center",this.ctx.textBaseline="middle";const i=t.x+t.width/2,a=t.y+t.height/2;let l=t.text;t.text.length>10&&(l=t.text.substring(0,10)+"..."),this.ctx.shadowColor="rgba(0, 0, 0, 0.5)",this.ctx.shadowBlur=4,this.ctx.shadowOffsetX=2,this.ctx.shadowOffsetY=2,this.ctx.fillText(l,i,a)}else{if(s.alpha<1){const e=this.ctx.createLinearGradient(t.x,t.y,t.x,t.y+t.height);e.addColorStop(0,`rgba(255, 255, 255, ${.3*s.alpha})`),e.addColorStop(1,"rgba(255, 255, 255, 0)"),this.ctx.fillStyle=e,this.ctx.fillRect(t.x,t.y,t.width,t.height)}t.width>3&&(this.ctx.strokeStyle=`rgba(255, 255, 255, ${.1*s.alpha})`,this.ctx.lineWidth=.5,this.ctx.strokeRect(t.x,t.y,t.width,t.height))}this.ctx.restore()}})}drawBall(t){this.ctx.save(),this.ctx.fillStyle="#FFD700",this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.radius,0,2*Math.PI),this.ctx.fill(),this.ctx.fillStyle="rgba(255, 255, 255, 0.4)",this.ctx.beginPath(),this.ctx.arc(t.x-t.radius/3,t.y-t.radius/3,t.radius/3,0,2*Math.PI),this.ctx.fill(),this.ctx.restore()}drawPaddle(t){this.ctx.save();const e=this.ctx.createLinearGradient(t.x,t.y,t.x,t.y+t.height);e.addColorStop(0,"#D4D4D4"),e.addColorStop(1,"#CCCCCC"),this.ctx.fillStyle=e,this.ctx.fillRect(t.x,t.y,t.width,t.height),this.ctx.strokeStyle="#FFFFFF",this.ctx.lineWidth=2,this.ctx.strokeRect(t.x,t.y,t.width,t.height),this.ctx.restore()}drawParticles(t){t.forEach(t=>{this.ctx.save(),this.ctx.globalAlpha=t.life,this.ctx.fillStyle=t.color,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size,0,2*Math.PI),this.ctx.fill(),this.ctx.restore()})}drawScore(t,e=20,i=30){this.ctx.save(),this.ctx.fillStyle="#FFFFFF",this.ctx.font="bold 20px Arial",this.ctx.textAlign="left",this.ctx.fillText(`Score: ${t}`,e,i),this.ctx.restore()}drawGameOver(t,e){this.ctx.save(),this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(0,0,t,e);const i=Math.min(48,.12*t),s=Math.min(24,.06*t);this.ctx.fillStyle="#FFFFFF",this.ctx.font=`bold ${i}px "Bitcount Prop Single"`,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("THANKS FOR",t/2,e/2-60),this.ctx.fillText("CONNECTING!",t/2,e/2-60+i),this.ctx.font=`${s}px "Bitcount Prop Single"`,this.ctx.fillText("Tap or Press R to restart",t/2,e/2+20+i),this.ctx.restore()}drawGameClear(t,e,i){this.ctx.save(),this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(0,0,t,e);const s=Math.min(48,.12*t),a=Math.min(24,.06*t);this.ctx.fillStyle="#FFD700",this.ctx.font=`bold ${s}px "Bitcount Prop Single"`,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("PERFECT!",t/2,e/2-60),this.ctx.fillText("LET'S CONNECT!",t/2,e/2-60+s),this.ctx.fillStyle="#FFFFFF",this.ctx.font=`${a}px "Bitcount Prop Single"`,this.ctx.fillText(`Final Score: ${i}`,t/2,e/2-60+s+2*a),this.ctx.font=`${a}px "Bitcount Prop Single"`,this.ctx.fillText("Tap or Press R to restart",t/2,e/2-60+s+4*a),this.ctx.restore()}clear(t,e){this.ctx.clearRect(0,0,t,e)}}const o={name:"山田　太郎",nameEn:"Taro Yamada",title:"Senior Software Engineer",tagline:"Building the future, one line at a time.",company:"Tech Solutions Inc.",email:"taro.yamada@example.com",phone:"+81-90-0000-0000",sns:"https://example.com/taroy",website:"https://www.example.com/"},r={ballSpeed:10,ballRadius:12,paddleSpeed:12,paddleWidthRatio:.4,paddleHeight:4,gravity:0,friction:1,blockRecoveryTime:1e4,effectDuration:5e3,destructionRadius:30},c={company:"#60A5FA",tagline:"#C084FC",name:"#F16584",nameEn:"#34D399",title:"#A78BFA",email:"#4ECDC4",phone:"#FB923C",sns:"#EC4899",website:"#FBBF24"};class d{constructor(t,e){i(this,"canvas"),i(this,"config"),i(this,"ball"),i(this,"paddle"),i(this,"blockManager"),i(this,"particleSystem"),i(this,"renderer"),i(this,"gameRunning",!1),i(this,"gamePaused",!1),i(this,"gameOver",!1),i(this,"gameCleared",!1),i(this,"score",0),i(this,"animationFrameId",null),i(this,"lastTime",0),i(this,"frameCount",0),i(this,"lastFpsUpdate",0),i(this,"currentFps",0),i(this,"pointerX",0),i(this,"lastPointerMoveTime",0),i(this,"gameLoop",()=>{const t=performance.now();this.lastTime;this.lastTime=t;const e=performance.now();this.gamePaused||this.update(t);performance.now();const i=performance.now();this.render();performance.now();this.frameCount++,t-this.lastFpsUpdate>=1e3&&(this.currentFps=Math.round(1e3*this.frameCount/(t-this.lastFpsUpdate)),this.frameCount=0,this.lastFpsUpdate=t),this.gamePaused||this.update(t),this.render(),!this.gameRunning||this.gameOver||this.gameCleared||(this.animationFrameId=requestAnimationFrame(this.gameLoop))}),this.canvas=t;const o=(null==e?void 0:e.width)||t.width,r=(null==e?void 0:e.height)||t.height,d=(null==e?void 0:e.paddleWidthRatio)||.4,m=Math.floor(o*d);this.config={width:o,height:r,paddleSpeed:12,ballSpeed:10,ballRadius:12,paddleHeight:4,paddleWidthRatio:d,paddleWidth:m,gravity:0,friction:1,blockRecoveryTime:1e4,effectDuration:5e3,destructionRadius:30,dpr:1,...e};const g=this.config.dpr||1;this.ball=new s(this.config.width/2,this.config.height/2,this.config.ballRadius,this.config.ballSpeed),this.paddle=new a(this.config.width/2-this.config.paddleWidth/2,this.config.height-this.config.paddleHeight-1,this.config.paddleWidth,this.config.paddleHeight,this.config.paddleSpeed),this.blockManager=new l(this.config.blockRecoveryTime,this.config.effectDuration,g,c),this.particleSystem=new h,this.renderer=new n(t,g),this.setupEventListeners()}setupEventListeners(){this.canvas.addEventListener("mousemove",t=>{const e=this.canvas.getBoundingClientRect();this.pointerX=t.clientX-e.left,this.lastPointerMoveTime=performance.now()}),this.canvas.addEventListener("touchmove",t=>{const e=this.canvas.getBoundingClientRect();this.pointerX=t.touches[0].clientX-e.left,this.lastPointerMoveTime=performance.now()}),this.canvas.addEventListener("click",()=>{this.gameRunning||this.gameOver||this.gameCleared?(this.gameOver||this.gameCleared)&&this.restart():this.start()}),this.canvas.addEventListener("touchstart",t=>{t.preventDefault(),this.gameRunning||this.gameOver||this.gameCleared?(this.gameOver||this.gameCleared)&&this.restart():this.start()}),window.addEventListener("keydown",t=>{"r"!==t.key&&"R"!==t.key||(this.gameOver||this.gameCleared)&&this.restart()," "===t.key&&(this.gameRunning||this.gameOver||this.gameCleared?this.gameRunning&&this.togglePause():this.start())}),this.canvas.addEventListener("click",()=>{this.gameRunning||this.gameOver||this.gameCleared||this.start()})}isPointerActive(){return performance.now()-this.lastPointerMoveTime<500}initializeWithBusinessCard(t,e="standard"){this.blockManager.createBlocksFromBusinessCard(t,this.config.width,this.config.height,1,e),this.resetGameState()}start(){if(this.gameRunning)return;this.gameRunning=!0,this.gamePaused=!1;const t=(Math.random()-.5)*Math.PI/2;this.ball.setVelocity(Math.cos(t)*this.config.ballSpeed,-Math.abs(Math.sin(t)*this.config.ballSpeed)),this.lastTime=performance.now(),this.lastFpsUpdate=this.lastTime,this.frameCount=0,this.gameLoop()}togglePause(){this.gamePaused=!this.gamePaused}restart(){this.resetGameState(),this.blockManager.reset(),this.score=0,this.gameRunning=!1,this.gamePaused=!1,this.gameOver=!1,this.gameCleared=!1,this.particleSystem.clear(),this.render()}resetGameState(){const t=this.config.width-50;this.ball.reset(t,50),this.paddle.reset(this.config.width/2-this.config.paddleWidth/2,this.config.height-this.config.paddleHeight-1)}update(t){this.paddle.update(this.config.width,this.config.paddleSpeed),this.isPointerActive()&&!this.paddle.isKeyboardActive()&&this.paddle.updateFromPointer(this.pointerX,this.config.width),this.ball.update(),this.ball.checkWallCollision(this.config.width,this.config.height),this.ball.checkPaddleCollision(this.paddle.getPaddle().x,this.paddle.getPaddle().y,this.paddle.getPaddle().width,this.paddle.getPaddle().height),this.blockManager.updateBlockRecovery(t);const e=this.blockManager.checkCollision(this.ball.getBall().x,this.ball.getBall().y,this.ball.getBall().radius);if(-1!==e){const i=this.blockManager.getBlocks()[e];if(!i.isDestroyed){this.blockManager.destroyBlock(e,t),this.particleSystem.createBlockDestructionEffect(i.x+i.width/2,i.y+i.height/2,i.color,15),this.score+=10,this.destroyNearbyBlocks(this.ball.getBall().x,this.ball.getBall().y,.5*this.ball.getBall().radius,t);this.ball.checkBlockCollision(i.x,i.y,i.width,i.height).collided&&this.particleSystem.createImpactEffect(this.ball.getBall().x,this.ball.getBall().y,i.color,8)}}this.particleSystem.update(),this.ball.getBall().y>this.config.height+50&&(this.gameOver=!0,this.gameRunning=!1),this.blockManager.allBlocksDestroyed()&&(this.gameCleared=!0,this.gameRunning=!1)}destroyNearbyBlocks(t,e,i,s){this.blockManager.getBlocks().forEach((a,l)=>{if(a.isDestroyed)return;const h=a.x+a.width/2,n=a.y+a.height/2,o=h-t,r=n-e;Math.sqrt(o*o+r*r)<2*i&&(this.blockManager.destroyBlock(l,s),Math.random()<.3&&this.particleSystem.createBlockDestructionEffect(h,n,a.color,3),this.score+=5)})}render(){this.renderer.clear(this.config.width,this.config.height),this.renderer.drawBackground(this.config.width,this.config.height);const t=performance.now();this.renderer.drawBlocks(this.blockManager.getBlocks(),t,this.blockManager),this.renderer.drawBall(this.ball.getBall()),this.renderer.drawPaddle(this.paddle.getPaddle()),this.renderer.drawParticles(this.particleSystem.getParticles()),this.renderer.drawScore(this.score),this.gameOver?this.renderer.drawGameOver(this.config.width,this.config.height):this.gameCleared&&this.renderer.drawGameClear(this.config.width,this.config.height,this.score)}stop(){this.gameRunning=!1,null!==this.animationFrameId&&cancelAnimationFrame(this.animationFrameId)}getScore(){return this.score}getGameState(){return{running:this.gameRunning,paused:this.gamePaused,gameOver:this.gameOver,cleared:this.gameCleared}}}t.BallPhysics=s,t.BlockManager=l,t.DEFAULT_BUSINESS_CARD=o,t.DEFAULT_GAME_CONFIG=r,t.DEFAULT_LAYOUT="standard",t.GameEngine=d,t.PaddleController=a,t.ParticleSystem=h,t.Renderer=n,t.initializeGame=function(t,e,i,s="standard",a=!1){const l=document.getElementById(t);if(!l)throw new Error(`Container with ID "${t}" not found`);let h=l.clientWidth||600;h=Math.max(320,Math.min(910,h));let n=h,c=h/(91/55);l.style.height&&"0px"!==l.style.height||(l.style.height=`${c}px`),n=8*Math.floor(n/8),c=8*Math.floor(c/8);const m=window.devicePixelRatio||1,g=8*Math.floor(n*m/8),p=8*Math.floor(c*m/8),u=document.createElement("canvas");u.width=g,u.height=p,u.style.width=`${n}px`,u.style.height=`${c}px`,u.style.display="block",u.style.backgroundColor="#1a1a2e",u.style.borderRadius="8px",u.style.boxShadow="0 4px 6px rgba(0, 0, 0, 0.3)",u.style.margin="0 auto",l.appendChild(u);const x={...r,...i,width:n,height:c,dpr:m},y=new d(u,x),f={...o,...e};return y.initializeWithBusinessCard(f,s),a&&y.start(),y},t.initializeGameWithCanvas=function(t,e,i){const s=new d(t,i);return s.initializeWithBusinessCard(e),s},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});
