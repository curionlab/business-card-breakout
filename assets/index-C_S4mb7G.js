var Y=Object.defineProperty;var $=(g,t,e)=>t in g?Y(g,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):g[t]=e;var m=(g,t,e)=>$(g,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const n of a.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function e(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=e(s);fetch(s.href,a)}})();class N{constructor(t,e,i,s=6){m(this,"ball");m(this,"baseSpeed");this.ball={x:t,y:e,vx:0,vy:0,radius:i},this.baseSpeed=s}getBall(){return this.ball}update(){this.ball.x+=this.ball.vx,this.ball.y+=this.ball.vy;const t=Math.sqrt(this.ball.vx*this.ball.vx+this.ball.vy*this.ball.vy);if(t<this.baseSpeed&&t>0){const e=this.baseSpeed/t;this.ball.vx*=e,this.ball.vy*=e}}setVelocity(t,e){this.ball.vx=t,this.ball.vy=e}checkWallCollision(t,e){this.ball.x-this.ball.radius<0&&(this.ball.x=this.ball.radius,this.ball.vx=Math.abs(this.ball.vx)),this.ball.x+this.ball.radius>t&&(this.ball.x=t-this.ball.radius,this.ball.vx=-Math.abs(this.ball.vx)),this.ball.y-this.ball.radius<0&&(this.ball.y=this.ball.radius,this.ball.vy=Math.abs(this.ball.vy))}reset(t,e){this.ball.x=t,this.ball.y=e,this.ball.vx=0,this.ball.vy=0}checkPaddleCollision(t,e,i,s){if(this.ball.y+this.ball.radius>=e&&this.ball.y-this.ball.radius<=e+s&&this.ball.x+this.ball.radius>=t&&this.ball.x-this.ball.radius<=t+i){const n=((this.ball.x-t)/i-.5)*Math.PI*.7;return this.ball.vx=Math.sin(n)*this.baseSpeed,this.ball.vy=-Math.abs(Math.cos(n)*this.baseSpeed),this.ball.y=e-this.ball.radius,!0}return!1}checkBlockCollision(t,e,i,s){const a=Math.max(t,Math.min(this.ball.x,t+i)),n=Math.max(e,Math.min(this.ball.y,e+s)),l=this.ball.x-a,o=this.ball.y-n,h=l*l+o*o;if(h<this.ball.radius*this.ball.radius){const c=Math.sqrt(h),u=c>0?l/c:0,w=c>0?o/c:0,T=this.ball.radius-c;this.ball.x+=u*T,this.ball.y+=w*T;const S=this.ball.vx*u+this.ball.vy*w;return this.ball.vx=this.ball.vx-2*S*u,this.ball.vy=this.ball.vy-2*S*w,{collided:!0,normal:{x:u,y:w}}}return{collided:!1,normal:{x:0,y:0}}}}class U{constructor(t,e,i,s,a=8){m(this,"paddle");m(this,"keysPressed",new Map);m(this,"lastKeyPressTime",0);this.paddle={x:t,y:e,width:i,height:s,vx:0},this.setupKeyListeners()}getPaddle(){return this.paddle}getWidth(){return this.paddle.width}setupKeyListeners(){typeof window>"u"||(window.addEventListener("keydown",t=>{const e=t.key.toLowerCase();this.keysPressed.set(e,!0),(e==="arrowleft"||e==="arrowright"||e==="a"||e==="d")&&(this.lastKeyPressTime=performance.now())}),window.addEventListener("keyup",t=>{this.keysPressed.set(t.key.toLowerCase(),!1)}))}isKeyboardActive(){return performance.now()-this.lastKeyPressTime<500}update(t,e){this.paddle.vx=0,(this.keysPressed.get("arrowleft")||this.keysPressed.get("a"))&&(this.paddle.vx=-e,this.lastKeyPressTime=performance.now()),(this.keysPressed.get("arrowright")||this.keysPressed.get("d"))&&(this.paddle.vx=e,this.lastKeyPressTime=performance.now()),this.paddle.x+=this.paddle.vx,this.paddle.x<0&&(this.paddle.x=0),this.paddle.x+this.paddle.width>t&&(this.paddle.x=t-this.paddle.width)}updateFromPointer(t,e){const i=t-this.paddle.width/2;this.paddle.x=Math.max(0,Math.min(i,e-this.paddle.width))}reset(t,e){this.paddle.x=t,this.paddle.y=e,this.paddle.vx=0}}class X{constructor(t=1e4,e=5e3,i=1,s={}){m(this,"blocks",[]);m(this,"blockRecoveryTime");m(this,"blockFadeInTime");m(this,"dpr",1);m(this,"elementColors");this.blockRecoveryTime=t,this.blockFadeInTime=e,this.dpr=i,this.elementColors=s}getBlocks(){return this.blocks}calculateFontSize(t,e,i=16){const s=e*t;return Math.max(Math.round(s),i)}calculateCanvasSize(t,e){const i=e*t;return Math.round(i)}drawTextFitToWidth(t,e,i,s,a,n,l,o="left"){t.font=`${n}px ${l}`;const h=t.measureText(e),c=h.width;if(c<=a)return t.textAlign=o,t.fillText(e,i,s),{actualHeight:h.actualBoundingBoxAscent+h.actualBoundingBoxDescent,metrics:h};const u=a/c;t.save();const w=i/u;return t.scale(u,1),t.textAlign=o,t.fillText(e,w,s),t.restore(),{actualHeight:h.actualBoundingBoxAscent+h.actualBoundingBoxDescent,metrics:h}}getFontFamily(t){const e=/[\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]/.test(t),i=/[\u4E00-\u9FFF]/.test(t)&&!e,s=/[\uAC00-\uD7AF\u1100-\u11FF]/.test(t),a=/[\u0E00-\u0E7F]/.test(t),n=/[\u0600-\u06FF]/.test(t),l=/[\u0400-\u04FF]/.test(t);return e?'"DotGothic16", monospace':i?'"ZCOOL QingKe HuangYou", "Noto Sans SC", sans-serif':s?'"Noto Sans KR", sans-serif':a?'"Noto Sans Thai", sans-serif':n?'"Noto Sans Arabic", sans-serif':l?'"Silkscreen", "Press Start 2P", monospace':'"Bitcount Prop Single", "DotGothic16", monospace'}createStandardLayout(t,e,i,s){const a=document.createElement("canvas"),n=a.getContext("2d",{willReadFrequently:!0});if(!n)return;const l=this.calculateCanvasSize(.08,i),o=this.calculateCanvasSize(.85,e),h=this.calculateCanvasSize(.81,i);console.log("createStandardLayout:",{canvasWidth:e,canvasHeight:i,padding:l,logicalTempWidth:o,logicalTempHeight:h,dpr:this.dpr}),a.width=o*this.dpr,a.height=h*this.dpr,n.imageSmoothingEnabled=!0,n.clearRect(0,0,a.width,a.height),n.scale(this.dpr,this.dpr),n.fillStyle="#FFFFFF";let c=l;const u=[],w=1.5,T=1.6,S=1.8,b=1.5,C=1;if(t.name){const p=this.calculateFontSize(.095,i,16),x=c,F=this.getFontFamily(t.name),r=o-l*2;n.textBaseline="top";const{actualHeight:d}=this.drawTextFitToWidth(n,t.name,l,c,r,p,F,"left"),f=d*w;u.push({start:x,end:x+f,type:"name"}),c+=f+C}if(t.title){const p=this.calculateFontSize(.055,i,16),x=c,F=this.getFontFamily(t.title),r=o-l*2;n.textBaseline="top";const{actualHeight:d}=this.drawTextFitToWidth(n,t.title,l,c,r,p,F,"left"),f=d*T;u.push({start:x,end:x+f,type:"title"}),c+=f+C}if(t.company){const p=this.calculateFontSize(.065,i,16),x=c,F=this.getFontFamily(t.company),r=o-l*2;n.textBaseline="top";const{actualHeight:d}=this.drawTextFitToWidth(n,t.company,l,c,r,p,F,"left"),f=d*S;u.push({start:x,end:x+f,type:"company"}),c+=f+C}const y=this.calculateFontSize(.04,i,12),v=o-l*2;n.textBaseline="top",[{data:t.email,type:"email"},{data:t.phone,type:"phone"},{data:t.sns,type:"sns"},{data:t.website,type:"website"}].forEach(p=>{if(!p.data)return;const x=c,F=this.getFontFamily(p.data),{actualHeight:r}=this.drawTextFitToWidth(n,p.data,l,c,v,y,F,"left"),d=r*b;u.push({start:x,end:x+d,type:p.type}),c+=d+C}),this.generateBlocksFromCanvas(a,e,i,s,u,{company:this.elementColors.company||"#60A5FA",name:this.elementColors.name||"#FF6B8A",title:this.elementColors.titleEn||"#A78BFA",email:this.elementColors.email||"#34D399",phone:this.elementColors.phone||"#FB923C",sns:this.elementColors.sns||"#F472B6",website:this.elementColors.website||"#FBBF24"},1)}createProfessionalLayout(t,e,i,s){const a=document.createElement("canvas"),n=a.getContext("2d",{willReadFrequently:!0});if(!n)return;n.imageSmoothingEnabled=!0;const l=this.calculateCanvasSize(.08,i),o=this.calculateCanvasSize(.85,e),h=this.calculateCanvasSize(.81,i);console.log("createProfessionalLayout (logical):",{canvasWidth:e,canvasHeight:i,padding:l,logicalTempWidth:o,logicalTempHeight:h,dpr:this.dpr}),a.width=o*this.dpr,a.height=h*this.dpr,n.imageSmoothingEnabled=!0,n.clearRect(0,0,a.width,a.height),n.scale(this.dpr,this.dpr),n.fillStyle="#FFFFFF";const c=1.3,u=1.7,w=1.4,T=1.5,S=1.8,b=1.4,C=1;let y=l;const v=[];if(t.company){const r=this.calculateFontSize(.08,i,12),d=y,f=this.getFontFamily(t.company),P=o-l*2;n.textBaseline="top";const{actualHeight:E}=this.drawTextFitToWidth(n,t.company,o/2,y,P,r,f,"center"),B=E*c;v.push({start:d,end:d+B,type:"company"}),y+=B+C}if(t.tagline){const r=this.calculateFontSize(.035,i,12),d=y,f=this.getFontFamily(t.tagline),P=o-l*2;n.textBaseline="top";const{actualHeight:E}=this.drawTextFitToWidth(n,t.tagline,o/2,y,P,r,f,"center"),B=E*u;v.push({start:d,end:d+B,type:"tagline"}),y+=B+C}if(t.name){const r=this.calculateFontSize(.11,i,12),d=y,f=this.getFontFamily(t.name),P=o-l*2;n.textBaseline="top";const{actualHeight:E}=this.drawTextFitToWidth(n,t.name,l,y,P,r,f,"left"),B=E*w;v.push({start:d,end:d+B,type:"name"}),y+=B+C}if(t.nameEn){const r=this.calculateFontSize(.05,i,10),d=y,f=this.getFontFamily(t.nameEn),P=o-l*2;n.textBaseline="top";const{actualHeight:E}=this.drawTextFitToWidth(n,t.nameEn,l,y,P,r,f,"left"),B=E*T;v.push({start:d,end:d+B,type:"nameEn"}),y+=B+C}if(t.title){const r=this.calculateFontSize(.048,i,12),d=y,f=this.getFontFamily(t.title),P=o-l*2;n.textBaseline="top";const{actualHeight:E}=this.drawTextFitToWidth(n,t.title,l,y,P,r,f,"left"),B=E*S;v.push({start:d,end:d+B,type:"title"}),y+=B+C}const p=this.calculateFontSize(.038,i,10),x=.15,F=.02;[{label:"Email",data:t.email,type:"email"},{label:"Phone",data:t.phone,type:"phone"},{label:"SNS",data:t.sns,type:"sns"},{label:"Website",data:t.website,type:"website"}].forEach(r=>{if(!r.data)return;const d=y,f=this.getFontFamily(r.label),P=this.getFontFamily(r.data);n.textBaseline="top";const E=o-l*2,B=E*x,L=E*F,W=E-B-L,{actualHeight:I}=this.drawTextFitToWidth(n,r.label,l,y,B,p,f,"left"),O=l+B+L,{actualHeight:G}=this.drawTextFitToWidth(n,r.data,O,y,W,p,P,"left"),A=Math.max(I,G)*b;v.push({start:d,end:d+A,type:r.type}),y+=A+C}),this.generateBlocksFromCanvas(a,e,i,s,v,{company:this.elementColors.company||"#60A5FA",tagline:this.elementColors.tagline||"#A78BFA",name:this.elementColors.name||"#FF6B8A",nameEn:this.elementColors.nameEn||"#4ECDC4",title:this.elementColors.titleEn||"#A78BFA",email:this.elementColors.email||"#34D399",phone:this.elementColors.phone||"#FB923C",sns:this.elementColors.sns||"#F472B6",website:this.elementColors.website||"#FBBF24"},1)}createMinimalLayout(t,e,i,s){const a=document.createElement("canvas"),n=a.getContext("2d",{willReadFrequently:!0});if(!n)return;n.imageSmoothingEnabled=!0;const l=this.calculateCanvasSize(.08,i),o=this.calculateCanvasSize(.8,e),h=this.calculateCanvasSize(.81,i);console.log("createMinimalLayout (logical):",{canvasWidth:e,canvasHeight:i,padding:l,logicalTempWidth:o,logicalTempHeight:h,dpr:this.dpr}),a.width=o*this.dpr,a.height=h*this.dpr,n.imageSmoothingEnabled=!0,n.clearRect(0,0,a.width,a.height),n.scale(this.dpr,this.dpr),n.fillStyle="#FFFFFF";const c=1.6,u=2.5,w=1.6,T=1;let S=l;const b=[];if(t.name){const p=this.calculateFontSize(.12,i,16),x=S,F=this.getFontFamily(t.name),r=o-l*2;n.textBaseline="top";const{actualHeight:d}=this.drawTextFitToWidth(n,t.name,o/2,S,r,p,F,"center"),f=d*c;b.push({start:x,end:x+f,type:"name"}),S+=f+T}const C=[t.title,t.company].filter(Boolean).join(" | ");if(C){const p=this.calculateFontSize(.045,i,16),x=S,F=this.getFontFamily(C),r=o-l*2;n.textBaseline="top";const{actualHeight:d}=this.drawTextFitToWidth(n,C,o/2,S,r,p,F,"center"),f=d*u;b.push({start:x,end:x+f,type:"title"}),S+=f+T}const y=this.calculateFontSize(.035,i,12),v=o-l*2;n.textBaseline="top",[{data:t.email,type:"email"},{data:t.phone,type:"phone"},{data:t.sns,type:"sns"},{data:t.website,type:"website"}].forEach(p=>{if(!p.data)return;const x=S,F=this.getFontFamily(p.data),{actualHeight:r}=this.drawTextFitToWidth(n,p.data,o/2,S,v,y,F,"center"),d=r*w;b.push({start:x,end:x+d,type:p.type}),S+=d+T}),this.generateBlocksFromCanvas(a,e,i,s,b,{name:this.elementColors.name||"#FF6B8A",title:this.elementColors.titleEn||"#A78BFA",email:this.elementColors.email||"#34D399",phone:this.elementColors.phone||"#FB923C",sns:this.elementColors.sns||"#F472B6",website:this.elementColors.website||"#FBBF24"},1)}createBlocksFromBusinessCard(t,e,i,s=1,a="standard"){switch(this.blocks=[],a){case"standard":this.createStandardLayout(t,e,i,s);break;case"professional":this.createProfessionalLayout(t,e,i,s);break;case"minimal":this.createMinimalLayout(t,e,i,s);break}}generateBlocksFromCanvas(t,e,i,s,a,n,l=1){const o=t.getContext("2d");if(!o)return;const c=o.getImageData(0,0,t.width,t.height).data,u=1/this.dpr,w=t.width*u,T=t.height*u,S=(e-w)/2,b=(i-T)/2,C=p=>{for(const F of a)if(p>=F.start&&p<=F.end)return n[F.type]||"#FFFFFF";if(a.length===0)return"#FFFFFF";const x=a.reduce((F,r)=>{const d=(r.start+r.end)/2,f=Math.abs(p-d),P=(F.start+F.end)/2,E=Math.abs(p-P);return f<E?r:F},a[0]);return n[x==null?void 0:x.type]||"#FFFFFF"},y=s,v=l;for(let p=0;p<t.height;p+=y){const x=p*u,F=C(x);for(let r=0;r<t.width;r+=y){const d=(p*t.width+r)*4;if(c[d+3]>80){const f=r*u;this.blocks.push({x:Math.round(S+f),y:Math.round(b+x),width:v,height:v,text:"",isDestroyed:!1,destroyedAt:0,color:F,fontSize:0,fontFamily:""})}}}console.log(`Generated ${this.blocks.length} blocks`)}destroyBlock(t,e){return t>=0&&t<this.blocks.length&&!this.blocks[t].isDestroyed?(this.blocks[t].isDestroyed=!0,this.blocks[t].destroyedAt=e,!0):!1}getBlockRecoveryState(t,e){if(!t.isDestroyed)return{isDestroyed:!1,alpha:1};const i=e-t.destroyedAt;if(i<this.blockRecoveryTime)return{isDestroyed:!0,alpha:0};const s=i-this.blockRecoveryTime;return s<this.blockFadeInTime?{isDestroyed:!1,alpha:s/this.blockFadeInTime}:{isDestroyed:!1,alpha:1}}updateBlockRecovery(t){this.blocks.forEach(e=>{e.isDestroyed&&t-e.destroyedAt>=this.blockRecoveryTime+this.blockFadeInTime&&(e.isDestroyed=!1)})}checkCollision(t,e,i){for(let s=0;s<this.blocks.length;s++){const a=this.blocks[s];if(a.isDestroyed)continue;const n=Math.max(a.x,Math.min(t,a.x+a.width)),l=Math.max(a.y,Math.min(e,a.y+a.height)),o=t-n,h=e-l;if(o*o+h*h<i*i)return s}return-1}allBlocksDestroyed(){return this.blocks.every(t=>t.isDestroyed)}reset(){this.blocks.forEach(t=>{t.isDestroyed=!1,t.destroyedAt=0})}setBlockRecoveryTime(t){this.blockRecoveryTime=t}setBlockFadeInTime(t){this.blockFadeInTime=t}}class H{constructor(){m(this,"particles",[])}getParticles(){return this.particles}createBlockDestructionEffect(t,e,i,s=12){for(let a=0;a<s;a++){const n=a/s*Math.PI*2,l=3+Math.random()*4,o=Math.cos(n)*l,h=Math.sin(n)*l;this.particles.push({x:t,y:e,vx:o,vy:h,life:1,maxLife:1,color:i,size:4+Math.random()*4})}}createImpactEffect(t,e,i,s=8){for(let a=0;a<s;a++){const n=a/s*Math.PI*2+(Math.random()-.5)*.5,l=2+Math.random()*3,o=Math.cos(n)*l,h=Math.sin(n)*l;this.particles.push({x:t,y:e,vx:o,vy:h,life:1,maxLife:1,color:i,size:2+Math.random()*3})}}update(){this.particles=this.particles.filter(t=>(t.life-=.05,t.x+=t.vx,t.y+=t.vy,t.vy+=.2,t.vx*=.98,t.life>0))}clear(){this.particles=[]}}class K{constructor(t,e=1){m(this,"ctx");const i=t.getContext("2d");if(!i)throw new Error("Failed to get 2D context from canvas");this.ctx=i,this.ctx.scale(e,e)}drawBackground(t,e){const i=this.ctx.createLinearGradient(0,0,0,e);i.addColorStop(0,"#1a1a2e"),i.addColorStop(1,"#16213e"),this.ctx.fillStyle=i,this.ctx.fillRect(0,0,t,e)}drawBlocks(t,e,i){t.forEach(s=>{const a=i.getBlockRecoveryState(s,e);if(!(a.isDestroyed&&a.alpha===0)){if(this.ctx.save(),this.ctx.globalAlpha=a.alpha,this.ctx.fillStyle=s.color,this.ctx.fillRect(s.x,s.y,s.width,s.height),!s.text||s.text.length===0){if(a.alpha<1){const n=this.ctx.createLinearGradient(s.x,s.y,s.x,s.y+s.height);n.addColorStop(0,`rgba(255, 255, 255, ${.3*a.alpha})`),n.addColorStop(1,"rgba(255, 255, 255, 0)"),this.ctx.fillStyle=n,this.ctx.fillRect(s.x,s.y,s.width,s.height)}s.width>3&&(this.ctx.strokeStyle=`rgba(255, 255, 255, ${.1*a.alpha})`,this.ctx.lineWidth=.5,this.ctx.strokeRect(s.x,s.y,s.width,s.height))}else{this.ctx.strokeStyle=`rgba(255, 255, 255, ${.3*a.alpha})`,this.ctx.lineWidth=2,this.ctx.strokeRect(s.x,s.y,s.width,s.height);const n=this.ctx.createLinearGradient(s.x,s.y,s.x,s.y+s.height);n.addColorStop(0,`rgba(255, 255, 255, ${.2*a.alpha})`),n.addColorStop(.5,"rgba(255, 255, 255, 0)"),n.addColorStop(1,`rgba(0, 0, 0, ${.1*a.alpha})`),this.ctx.fillStyle=n,this.ctx.fillRect(s.x,s.y,s.width,s.height),this.ctx.fillStyle="#ffffff",this.ctx.font=`bold ${s.fontSize}px ${s.fontFamily}`,this.ctx.textAlign="center",this.ctx.textBaseline="middle";const l=s.x+s.width/2,o=s.y+s.height/2;let h=s.text;s.text.length>10&&(h=s.text.substring(0,10)+"..."),this.ctx.shadowColor="rgba(0, 0, 0, 0.5)",this.ctx.shadowBlur=4,this.ctx.shadowOffsetX=2,this.ctx.shadowOffsetY=2,this.ctx.fillText(h,l,o)}this.ctx.restore()}})}drawBall(t){this.ctx.save(),this.ctx.fillStyle="#FFD700",this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.radius,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="rgba(255, 255, 255, 0.4)",this.ctx.beginPath(),this.ctx.arc(t.x-t.radius/3,t.y-t.radius/3,t.radius/3,0,Math.PI*2),this.ctx.fill(),this.ctx.restore()}drawPaddle(t){this.ctx.save();const e=this.ctx.createLinearGradient(t.x,t.y,t.x,t.y+t.height);e.addColorStop(0,"#D4D4D4"),e.addColorStop(1,"#CCCCCC"),this.ctx.fillStyle=e,this.ctx.fillRect(t.x,t.y,t.width,t.height),this.ctx.strokeStyle="#FFFFFF",this.ctx.lineWidth=2,this.ctx.strokeRect(t.x,t.y,t.width,t.height),this.ctx.restore()}drawParticles(t){t.forEach(e=>{this.ctx.save(),this.ctx.globalAlpha=e.life,this.ctx.fillStyle=e.color,this.ctx.beginPath(),this.ctx.arc(e.x,e.y,e.size,0,Math.PI*2),this.ctx.fill(),this.ctx.restore()})}drawScore(t,e=20,i=30){this.ctx.save(),this.ctx.fillStyle="#FFFFFF",this.ctx.font="bold 20px Arial",this.ctx.textAlign="left",this.ctx.fillText(`Score: ${t}`,e,i),this.ctx.restore()}drawGameOver(t,e){this.ctx.save(),this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(0,0,t,e);const i=Math.min(48,t*.12),s=Math.min(24,t*.06);this.ctx.fillStyle="#FFFFFF",this.ctx.font=`bold ${i}px "Bitcount Prop Single"`,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("THANKS FOR",t/2,e/2-60),this.ctx.fillText("CONNECTING!",t/2,e/2-60+i),this.ctx.font=`${s}px "Bitcount Prop Single"`,this.ctx.fillText("Tap or Press R to restart",t/2,e/2+20+i),this.ctx.restore()}drawGameClear(t,e,i){this.ctx.save(),this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(0,0,t,e);const s=Math.min(48,t*.12),a=Math.min(24,t*.06);this.ctx.fillStyle="#FFD700",this.ctx.font=`bold ${s}px "Bitcount Prop Single"`,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("PERFECT!",t/2,e/2-60),this.ctx.fillText("LET'S CONNECT!",t/2,e/2-60+s),this.ctx.fillStyle="#FFFFFF",this.ctx.font=`${a}px "Bitcount Prop Single"`,this.ctx.fillText(`Final Score: ${i}`,t/2,e/2-60+s+2*a),this.ctx.font=`${a}px "Bitcount Prop Single"`,this.ctx.fillText("Tap or Press R to restart",t/2,e/2-60+s+4*a),this.ctx.restore()}clear(t,e){this.ctx.clearRect(0,0,t,e)}}const M={name:"山田　太郎",nameEn:"Taro Yamada",title:"Senior Software Engineer",tagline:"Building the future, one line at a time.",company:"Tech Solutions Inc.",email:"taro.yamada@example.com",phone:"+81-90-0000-0000",sns:"https://example.com/taroy",website:"https://www.example.com/"},D={ballSpeed:10,ballRadius:12,paddleSpeed:12,paddleWidthRatio:.4,paddleHeight:4,gravity:0,friction:1,blockRecoveryTime:1e4,effectDuration:5e3,destructionRadius:30},_="standard",q={company:"#60A5FA",tagline:"#C084FC",name:"#F16584",nameEn:"#34D399",title:"#A78BFA",email:"#4ECDC4",phone:"#FB923C",sns:"#EC4899",website:"#FBBF24"};class j{constructor(t,e){m(this,"canvas");m(this,"config");m(this,"ball");m(this,"paddle");m(this,"blockManager");m(this,"particleSystem");m(this,"renderer");m(this,"gameRunning",!1);m(this,"gamePaused",!1);m(this,"gameOver",!1);m(this,"gameCleared",!1);m(this,"score",0);m(this,"animationFrameId",null);m(this,"lastTime",0);m(this,"frameCount",0);m(this,"lastFpsUpdate",0);m(this,"currentFps",0);m(this,"pointerX",0);m(this,"lastPointerMoveTime",0);m(this,"gameLoop",()=>{const t=performance.now(),e=t-this.lastTime;this.lastTime=t;const i=performance.now();this.gamePaused||this.update(t);const s=performance.now()-i,a=performance.now();this.render();const n=performance.now()-a;this.frameCount++,t-this.lastFpsUpdate>=1e3&&(this.currentFps=Math.round(this.frameCount*1e3/(t-this.lastFpsUpdate)),console.log(`FPS: ${this.currentFps} | Update: ${s.toFixed(2)}ms | Render: ${n.toFixed(2)}ms | Frame Time: ${e.toFixed(2)}ms `),this.frameCount=0,this.lastFpsUpdate=t),this.gamePaused||this.update(t),this.render(),this.gameRunning&&!this.gameOver&&!this.gameCleared&&(this.animationFrameId=requestAnimationFrame(this.gameLoop))});this.canvas=t;const i=(e==null?void 0:e.width)||t.width,s=(e==null?void 0:e.height)||t.height,a=(e==null?void 0:e.paddleWidthRatio)||.4,n=Math.floor(i*a);this.config={width:i,height:s,paddleSpeed:12,ballSpeed:10,ballRadius:12,paddleHeight:4,paddleWidthRatio:a,paddleWidth:n,gravity:0,friction:1,blockRecoveryTime:1e4,effectDuration:5e3,destructionRadius:30,dpr:1,...e};const l=this.config.dpr||1;console.log("GameEngine.tsのdpr:",l),this.ball=new N(this.config.width/2,this.config.height/2,this.config.ballRadius,this.config.ballSpeed),this.paddle=new U(this.config.width/2-this.config.paddleWidth/2,this.config.height-this.config.paddleHeight-1,this.config.paddleWidth,this.config.paddleHeight,this.config.paddleSpeed),this.blockManager=new X(this.config.blockRecoveryTime,this.config.effectDuration,l,q),this.particleSystem=new H,this.renderer=new K(t,l),this.setupEventListeners()}setupEventListeners(){this.canvas.addEventListener("mousemove",t=>{const e=this.canvas.getBoundingClientRect();this.pointerX=t.clientX-e.left,this.lastPointerMoveTime=performance.now()}),this.canvas.addEventListener("touchmove",t=>{const e=this.canvas.getBoundingClientRect();this.pointerX=t.touches[0].clientX-e.left,this.lastPointerMoveTime=performance.now()}),this.canvas.addEventListener("click",()=>{!this.gameRunning&&!this.gameOver&&!this.gameCleared?this.start():(this.gameOver||this.gameCleared)&&this.restart()}),this.canvas.addEventListener("touchstart",t=>{t.preventDefault(),!this.gameRunning&&!this.gameOver&&!this.gameCleared?this.start():(this.gameOver||this.gameCleared)&&this.restart()}),window.addEventListener("keydown",t=>{(t.key==="r"||t.key==="R")&&(this.gameOver||this.gameCleared)&&this.restart(),t.key===" "&&(!this.gameRunning&&!this.gameOver&&!this.gameCleared?this.start():this.gameRunning&&this.togglePause())}),this.canvas.addEventListener("click",()=>{!this.gameRunning&&!this.gameOver&&!this.gameCleared&&this.start()})}isPointerActive(){return performance.now()-this.lastPointerMoveTime<500}initializeWithBusinessCard(t,e="standard"){console.log("initializeWithBusinessCard called:",{layout:e,stackTrace:new Error().stack}),this.blockManager.createBlocksFromBusinessCard(t,this.config.width,this.config.height,1,e),this.resetGameState()}start(){if(this.gameRunning)return;this.gameRunning=!0,this.gamePaused=!1;const t=(Math.random()-.5)*Math.PI/2;this.ball.setVelocity(Math.cos(t)*this.config.ballSpeed,-Math.abs(Math.sin(t)*this.config.ballSpeed)),this.lastTime=performance.now(),this.lastFpsUpdate=this.lastTime,this.frameCount=0,this.gameLoop()}togglePause(){this.gamePaused=!this.gamePaused}restart(){this.resetGameState(),this.blockManager.reset(),this.score=0,this.gameRunning=!1,this.gamePaused=!1,this.gameOver=!1,this.gameCleared=!1,this.particleSystem.clear(),this.render()}resetGameState(){const t=this.config.width-50;this.ball.reset(t,50),this.paddle.reset(this.config.width/2-this.config.paddleWidth/2,this.config.height-this.config.paddleHeight-1)}update(t){this.paddle.update(this.config.width,this.config.paddleSpeed),this.isPointerActive()&&!this.paddle.isKeyboardActive()&&this.paddle.updateFromPointer(this.pointerX,this.config.width),this.ball.update(),this.ball.checkWallCollision(this.config.width,this.config.height),this.ball.checkPaddleCollision(this.paddle.getPaddle().x,this.paddle.getPaddle().y,this.paddle.getPaddle().width,this.paddle.getPaddle().height),this.blockManager.updateBlockRecovery(t);const e=this.blockManager.checkCollision(this.ball.getBall().x,this.ball.getBall().y,this.ball.getBall().radius);if(e!==-1){const i=this.blockManager.getBlocks()[e];i.isDestroyed||(this.blockManager.destroyBlock(e,t),this.particleSystem.createBlockDestructionEffect(i.x+i.width/2,i.y+i.height/2,i.color,15),this.score+=10,this.destroyNearbyBlocks(this.ball.getBall().x,this.ball.getBall().y,this.ball.getBall().radius*.5,t),this.ball.checkBlockCollision(i.x,i.y,i.width,i.height).collided&&this.particleSystem.createImpactEffect(this.ball.getBall().x,this.ball.getBall().y,i.color,8))}this.particleSystem.update(),this.ball.getBall().y>this.config.height+50&&(this.gameOver=!0,this.gameRunning=!1),this.blockManager.allBlocksDestroyed()&&(this.gameCleared=!0,this.gameRunning=!1)}destroyNearbyBlocks(t,e,i,s){this.blockManager.getBlocks().forEach((n,l)=>{if(n.isDestroyed)return;const o=n.x+n.width/2,h=n.y+n.height/2,c=o-t,u=h-e;Math.sqrt(c*c+u*u)<i*2&&(this.blockManager.destroyBlock(l,s),Math.random()<.3&&this.particleSystem.createBlockDestructionEffect(o,h,n.color,3),this.score+=5)})}render(){this.renderer.clear(this.config.width,this.config.height),this.renderer.drawBackground(this.config.width,this.config.height);const t=performance.now();this.renderer.drawBlocks(this.blockManager.getBlocks(),t,this.blockManager),this.renderer.drawBall(this.ball.getBall()),this.renderer.drawPaddle(this.paddle.getPaddle()),this.renderer.drawParticles(this.particleSystem.getParticles()),this.renderer.drawScore(this.score),this.gameOver?this.renderer.drawGameOver(this.config.width,this.config.height):this.gameCleared&&this.renderer.drawGameClear(this.config.width,this.config.height,this.score)}stop(){this.gameRunning=!1,this.animationFrameId!==null&&cancelAnimationFrame(this.animationFrameId)}getScore(){return this.score}getGameState(){return{running:this.gameRunning,paused:this.gamePaused,gameOver:this.gameOver,cleared:this.gameCleared}}}function V(g,t,e,i="standard",s=!1){const a=document.getElementById(g);if(!a)throw new Error(`Container with ID "${g}" not found`);const n=91/55,l=300,o=910;let h=a.clientWidth||600;h=Math.max(l,Math.min(o,h));let c=h,u=h/n;(!a.style.height||a.style.height==="0px")&&(a.style.height=`${u}px`),c=Math.floor(c/8)*8,u=Math.floor(u/8)*8;const w=window.devicePixelRatio||1,T=Math.floor(c*w/8)*8,S=Math.floor(u*w/8)*8,b=document.createElement("canvas");b.width=T,b.height=S,b.style.width=`${c}px`,b.style.height=`${u}px`,b.style.display="block",b.style.backgroundColor="#1a1a2e",b.style.borderRadius="8px",b.style.boxShadow="0 4px 6px rgba(0, 0, 0, 0.3)",b.style.margin="0 auto",a.appendChild(b);const C={...D,...e,width:c,height:u,dpr:w};console.log("index.tsのdpr:",w);const y=new j(b,C),v={...M,...t};return y.initializeWithBusinessCard(v,i),s&&y.start(),y}let R=null;const J={name:"nameInput",nameEn:"nameEnInput",title:"titleInput",tagline:"taglineInput",company:"companyInput",email:"emailInput",phone:"phoneInput",sns:"snsInput",website:"websiteInput"},Q=["standard","professional","minimal"],Z=()=>{document.getElementById("nameInput").value=M.name,document.getElementById("nameEnInput").value=M.nameEn,document.getElementById("titleInput").value=M.title,document.getElementById("taglineInput").value=M.tagline,document.getElementById("companyInput").value=M.company,document.getElementById("emailInput").value=M.email,document.getElementById("phoneInput").value=M.phone,document.getElementById("snsInput").value=M.sns,document.getElementById("websiteInput").value=M.website,document.getElementById("layoutSelect").value=_},k=()=>({name:document.getElementById("nameInput").value,nameEn:document.getElementById("nameEnInput").value,title:document.getElementById("titleInput").value,tagline:document.getElementById("taglineInput").value,company:document.getElementById("companyInput").value,email:document.getElementById("emailInput").value,phone:document.getElementById("phoneInput").value,sns:document.getElementById("snsInput").value,website:document.getElementById("websiteInput").value}),z=(g,t)=>{const e=document.getElementById("gameContainer");e.innerHTML="",R=V("gameContainer",g,D,t,!1),R.start()};window.startGame=function(){const g=k(),t=document.getElementById("layoutSelect").value;R&&R.stop(),z(g,t)};const tt=()=>{const g=new URLSearchParams(window.location.search);let t=!1;Object.entries(J).forEach(([i,s])=>{if(!g.has(i))return;const a=document.getElementById(s);a&&(a.value=g.get(i)||"",t=!0)});const e=g.get("layout");return e&&Q.includes(e)&&(document.getElementById("layoutSelect").value=e,t=!0),t},et=(g,t)=>{const e=new URLSearchParams;Object.entries(g).forEach(([s,a])=>{typeof a=="string"&&a.trim().length>0&&e.set(s,a.trim())}),t&&e.set("layout",t);const i=new URL(window.location.href);return i.search=e.toString(),i.hash="",i.toString()},st=g=>{const t=document.createElement("textarea");t.value=g,t.style.position="fixed",t.style.top="-1000px",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy")}finally{document.body.removeChild(t)}};window.shareBusinessCard=async function(){const g=k(),t=document.getElementById("layoutSelect").value,e=et(g,t);if(navigator.share)try{await navigator.share({title:"Business Card Breakout",text:"名刺ゲームを共有しました！",url:e});return}catch(i){if(i.name==="AbortError")return;console.warn("Web Share API failed, fallback to clipboard.",i)}try{navigator.clipboard&&window.isSecureContext?await navigator.clipboard.writeText(e):st(e),alert("共有リンクをクリップボードにコピーしました！")}catch(i){console.warn("Clipboard API failed, fallback to alert.",i),alert(`共有リンクをコピーできませんでした。
${e}`)}};window.addEventListener("load",()=>{tt()||Z();const t=k(),e=document.getElementById("layoutSelect").value;z(t,e)});
