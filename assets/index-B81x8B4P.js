var $=Object.defineProperty;var Y=(y,t,e)=>t in y?$(y,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):y[t]=e;var p=(y,t,e)=>Y(y,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const n of a.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function e(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=e(s);fetch(s.href,a)}})();class N{constructor(t,e,i,s=6){p(this,"ball");p(this,"baseSpeed");this.ball={x:t,y:e,vx:0,vy:0,radius:i},this.baseSpeed=s}getBall(){return this.ball}update(){this.ball.x+=this.ball.vx,this.ball.y+=this.ball.vy;const t=Math.sqrt(this.ball.vx*this.ball.vx+this.ball.vy*this.ball.vy);if(t<this.baseSpeed&&t>0){const e=this.baseSpeed/t;this.ball.vx*=e,this.ball.vy*=e}}setVelocity(t,e){this.ball.vx=t,this.ball.vy=e}checkWallCollision(t,e){this.ball.x-this.ball.radius<0&&(this.ball.x=this.ball.radius,this.ball.vx=Math.abs(this.ball.vx)),this.ball.x+this.ball.radius>t&&(this.ball.x=t-this.ball.radius,this.ball.vx=-Math.abs(this.ball.vx)),this.ball.y-this.ball.radius<0&&(this.ball.y=this.ball.radius,this.ball.vy=Math.abs(this.ball.vy))}reset(t,e){this.ball.x=t,this.ball.y=e,this.ball.vx=0,this.ball.vy=0}checkPaddleCollision(t,e,i,s){if(this.ball.y+this.ball.radius>=e&&this.ball.y-this.ball.radius<=e+s&&this.ball.x+this.ball.radius>=t&&this.ball.x-this.ball.radius<=t+i){const n=((this.ball.x-t)/i-.5)*Math.PI*.7;return this.ball.vx=Math.sin(n)*this.baseSpeed,this.ball.vy=-Math.abs(Math.cos(n)*this.baseSpeed),this.ball.y=e-this.ball.radius,!0}return!1}checkBlockCollision(t,e,i,s){const a=Math.max(t,Math.min(this.ball.x,t+i)),n=Math.max(e,Math.min(this.ball.y,e+s)),l=this.ball.x-a,o=this.ball.y-n,h=l*l+o*o;if(h<this.ball.radius*this.ball.radius){const c=Math.sqrt(h),u=c>0?l/c:0,b=c>0?o/c:0,C=this.ball.radius-c;this.ball.x+=u*C,this.ball.y+=b*C;const B=this.ball.vx*u+this.ball.vy*b;return this.ball.vx=this.ball.vx-2*B*u,this.ball.vy=this.ball.vy-2*B*b,{collided:!0,normal:{x:u,y:b}}}return{collided:!1,normal:{x:0,y:0}}}}class X{constructor(t,e,i,s,a=8){p(this,"paddle");p(this,"keysPressed",new Map);p(this,"lastKeyPressTime",0);this.paddle={x:t,y:e,width:i,height:s,vx:0},this.setupKeyListeners()}getPaddle(){return this.paddle}getWidth(){return this.paddle.width}setupKeyListeners(){typeof window>"u"||(window.addEventListener("keydown",t=>{const e=t.key.toLowerCase();this.keysPressed.set(e,!0),(e==="arrowleft"||e==="arrowright"||e==="a"||e==="d")&&(this.lastKeyPressTime=performance.now())}),window.addEventListener("keyup",t=>{this.keysPressed.set(t.key.toLowerCase(),!1)}))}isKeyboardActive(){return performance.now()-this.lastKeyPressTime<500}update(t,e){this.paddle.vx=0,(this.keysPressed.get("arrowleft")||this.keysPressed.get("a"))&&(this.paddle.vx=-e,this.lastKeyPressTime=performance.now()),(this.keysPressed.get("arrowright")||this.keysPressed.get("d"))&&(this.paddle.vx=e,this.lastKeyPressTime=performance.now()),this.paddle.x+=this.paddle.vx,this.paddle.x<0&&(this.paddle.x=0),this.paddle.x+this.paddle.width>t&&(this.paddle.x=t-this.paddle.width)}updateFromPointer(t,e){const i=t-this.paddle.width/2;this.paddle.x=Math.max(0,Math.min(i,e-this.paddle.width))}reset(t,e){this.paddle.x=t,this.paddle.y=e,this.paddle.vx=0}}class U{constructor(t=1e4,e=5e3,i=1,s={}){p(this,"blocks",[]);p(this,"blockRecoveryTime");p(this,"blockFadeInTime");p(this,"dpr",1);p(this,"elementColors");this.blockRecoveryTime=t,this.blockFadeInTime=e,this.dpr=i,this.elementColors=s}getBlocks(){return this.blocks}calculateFontSize(t,e,i=16){const s=e*t;return Math.max(Math.round(s),i)}calculateCanvasSize(t,e){const i=e*t;return Math.round(i)}drawTextFitToWidth(t,e,i,s,a,n,l,o="left"){t.font=`${n}px ${l}`;const h=t.measureText(e),c=h.width;if(c<=a)return t.textAlign=o,t.fillText(e,i,s),{actualHeight:h.actualBoundingBoxAscent+h.actualBoundingBoxDescent,metrics:h};const u=a/c;t.save();const b=i/u;return t.scale(u,1),t.textAlign=o,t.fillText(e,b,s),t.restore(),{actualHeight:h.actualBoundingBoxAscent+h.actualBoundingBoxDescent,metrics:h}}getFontFamily(t){const e=/[\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]/.test(t),i=/[\u4E00-\u9FFF]/.test(t)&&!e,s=/[\uAC00-\uD7AF\u1100-\u11FF]/.test(t),a=/[\u0E00-\u0E7F]/.test(t),n=/[\u0600-\u06FF]/.test(t),l=/[\u0400-\u04FF]/.test(t);return e?'"DotGothic16", monospace':i?'"ZCOOL QingKe HuangYou", "Noto Sans SC", sans-serif':s?'"Noto Sans KR", sans-serif':a?'"Noto Sans Thai", sans-serif':n?'"Noto Sans Arabic", sans-serif':l?'"Silkscreen", "Press Start 2P", monospace':'"Bitcount Prop Single", "DotGothic16", monospace'}createStandardLayout(t,e,i,s){const a=document.createElement("canvas"),n=a.getContext("2d",{willReadFrequently:!0});if(!n)return;const l=this.calculateCanvasSize(.08,i),o=this.calculateCanvasSize(.85,e),h=this.calculateCanvasSize(.81,i);console.log("createStandardLayout:",{canvasWidth:e,canvasHeight:i,padding:l,logicalTempWidth:o,logicalTempHeight:h,dpr:this.dpr}),a.width=Math.round(o*this.dpr),a.height=Math.round(h*this.dpr),n.imageSmoothingEnabled=!1,n.clearRect(0,0,a.width,a.height),n.scale(this.dpr,this.dpr),n.fillStyle="#FFFFFF";let c=l;const u=[],b=1.5,C=1.6,B=1.8,S=1.5,v=1;if(t.name){const F=this.calculateFontSize(.095,i,16),f=c,x=this.getFontFamily(t.name),d=o-l*2;n.textBaseline="top";const{actualHeight:r}=this.drawTextFitToWidth(n,t.name,l,c,d,F,x,"left"),m=r*b;u.push({start:f,end:f+m,type:"name"}),c+=m+v}if(t.title){const F=this.calculateFontSize(.055,i,16),f=c,x=this.getFontFamily(t.title),d=o-l*2;n.textBaseline="top";const{actualHeight:r}=this.drawTextFitToWidth(n,t.title,l,c,d,F,x,"left"),m=r*C;u.push({start:f,end:f+m,type:"title"}),c+=m+v}if(t.company){const F=this.calculateFontSize(.065,i,16),f=c,x=this.getFontFamily(t.company),d=o-l*2;n.textBaseline="top";const{actualHeight:r}=this.drawTextFitToWidth(n,t.company,l,c,d,F,x,"left"),m=r*B;u.push({start:f,end:f+m,type:"company"}),c+=m+v}const g=this.calculateFontSize(.04,i,12),E=o-l*2;n.textBaseline="top",[{data:t.email,type:"email"},{data:t.phone,type:"phone"},{data:t.sns,type:"sns"},{data:t.website,type:"website"}].forEach(F=>{if(!F.data)return;const f=c,x=this.getFontFamily(F.data),{actualHeight:d}=this.drawTextFitToWidth(n,F.data,l,c,E,g,x,"left"),r=d*S;u.push({start:f,end:f+r,type:F.type}),c+=r+v}),this.generateBlocksFromCanvas(a,e,i,s,u,{company:this.elementColors.company||"#60A5FA",name:this.elementColors.name||"#FF6B8A",title:this.elementColors.titleEn||"#A78BFA",email:this.elementColors.email||"#34D399",phone:this.elementColors.phone||"#FB923C",sns:this.elementColors.sns||"#F472B6",website:this.elementColors.website||"#FBBF24"},1)}createProfessionalLayout(t,e,i,s){const a=document.createElement("canvas"),n=a.getContext("2d",{willReadFrequently:!0});if(!n)return;n.imageSmoothingEnabled=!1;const l=this.calculateCanvasSize(.02,i),o=this.calculateCanvasSize(.85,e),h=this.calculateCanvasSize(.81,i);console.log("createProfessionalLayout (logical):",{canvasWidth:e,canvasHeight:i,padding:l,logicalTempWidth:o,logicalTempHeight:h,dpr:this.dpr}),a.width=o*this.dpr,a.height=h*this.dpr,n.imageSmoothingEnabled=!1,n.clearRect(0,0,a.width,a.height),n.scale(this.dpr,this.dpr),n.fillStyle="#FFFFFF";const c=1.3,u=1.9,b=1.35,C=1.4,B=1.8,S=1.4,v=1;let g=l;const E=[];if(t.company){const d=this.calculateFontSize(.09,i,12),r=g,m=this.getFontFamily(t.company),M=o-l*2;n.textBaseline="top";const{actualHeight:T}=this.drawTextFitToWidth(n,t.company,o/2,g,M,d,m,"center"),w=T*c;E.push({start:r,end:r+w,type:"company"}),g+=w+v}if(t.tagline){const d=this.calculateFontSize(.04,i,10),r=g,m=this.getFontFamily(t.tagline),M=o-l*2;n.textBaseline="top";const{actualHeight:T}=this.drawTextFitToWidth(n,t.tagline,o/2,g,M,d,m,"center"),w=T*u;E.push({start:r,end:r+w,type:"tagline"}),g+=w+v}if(t.name){const d=this.calculateFontSize(.12,i,12),r=g,m=this.getFontFamily(t.name),M=o-l*2;n.textBaseline="top";const{actualHeight:T}=this.drawTextFitToWidth(n,t.name,l,g,M,d,m,"left"),w=T*b;E.push({start:r,end:r+w,type:"name"}),g+=w+v}if(t.nameEn){const d=this.calculateFontSize(.05,i,10),r=g,m=this.getFontFamily(t.nameEn),M=o-l*2;n.textBaseline="top";const{actualHeight:T}=this.drawTextFitToWidth(n,t.nameEn,l,g,M,d,m,"left"),w=T*C;E.push({start:r,end:r+w,type:"nameEn"}),g+=w+v*12}if(t.title){const d=this.calculateFontSize(.052,i,12),r=g,m=this.getFontFamily(t.title),M=o-l*2;n.textBaseline="top";const{actualHeight:T}=this.drawTextFitToWidth(n,t.title,l,g,M,d,m,"left"),w=T*B;E.push({start:r,end:r+w,type:"title"}),g+=w+v}const F=this.calculateFontSize(.04,i,10),f=.17,x=.01;[{label:"Email",data:t.email,type:"email"},{label:"Phone",data:t.phone,type:"phone"},{label:"SNS",data:t.sns,type:"sns"},{label:"Website",data:t.website,type:"website"}].forEach(d=>{if(!d.data)return;const r=g,m=this.getFontFamily(d.label),M=this.getFontFamily(d.data);n.textBaseline="top";const T=o-l*2,w=T*f,R=T*x,k=T-w-R,{actualHeight:L}=this.drawTextFitToWidth(n,d.label,l,g,w,F,m,"left"),A=l+w+R,{actualHeight:G}=this.drawTextFitToWidth(n,d.data,A,g,k,F,M,"left"),W=Math.max(L,G)*S;E.push({start:r,end:r+W,type:d.type}),g+=W+v}),this.generateBlocksFromCanvas(a,e,i,s,E,{company:this.elementColors.company||"#60A5FA",tagline:this.elementColors.tagline||"#A78BFA",name:this.elementColors.name||"#FF6B8A",nameEn:this.elementColors.nameEn||"#4ECDC4",title:this.elementColors.titleEn||"#A78BFA",email:this.elementColors.email||"#34D399",phone:this.elementColors.phone||"#FB923C",sns:this.elementColors.sns||"#F472B6",website:this.elementColors.website||"#FBBF24"},1)}createMinimalLayout(t,e,i,s){const a=document.createElement("canvas"),n=a.getContext("2d",{willReadFrequently:!0});if(!n)return;n.imageSmoothingEnabled=!1;const l=this.calculateCanvasSize(.08,i),o=this.calculateCanvasSize(.8,e),h=this.calculateCanvasSize(.81,i);console.log("createMinimalLayout (logical):",{canvasWidth:e,canvasHeight:i,padding:l,logicalTempWidth:o,logicalTempHeight:h,dpr:this.dpr}),a.width=o*this.dpr,a.height=h*this.dpr,n.imageSmoothingEnabled=!1,n.clearRect(0,0,a.width,a.height),n.scale(this.dpr,this.dpr),n.fillStyle="#FFFFFF";const c=1.6,u=2.5,b=1.6,C=1;let B=l;const S=[];if(t.name){const F=this.calculateFontSize(.12,i,16),f=B,x=this.getFontFamily(t.name),d=o-l*2;n.textBaseline="top";const{actualHeight:r}=this.drawTextFitToWidth(n,t.name,o/2,B,d,F,x,"center"),m=r*c;S.push({start:f,end:f+m,type:"name"}),B+=m+C}const v=[t.title,t.company].filter(Boolean).join(" | ");if(v){const F=this.calculateFontSize(.045,i,16),f=B,x=this.getFontFamily(v),d=o-l*2;n.textBaseline="top";const{actualHeight:r}=this.drawTextFitToWidth(n,v,o/2,B,d,F,x,"center"),m=r*u;S.push({start:f,end:f+m,type:"title"}),B+=m+C}const g=this.calculateFontSize(.035,i,12),E=o-l*2;n.textBaseline="top",[{data:t.email,type:"email"},{data:t.phone,type:"phone"},{data:t.sns,type:"sns"},{data:t.website,type:"website"}].forEach(F=>{if(!F.data)return;const f=B,x=this.getFontFamily(F.data),{actualHeight:d}=this.drawTextFitToWidth(n,F.data,o/2,B,E,g,x,"center"),r=d*b;S.push({start:f,end:f+r,type:F.type}),B+=r+C}),this.generateBlocksFromCanvas(a,e,i,s,S,{name:this.elementColors.name||"#FF6B8A",title:this.elementColors.titleEn||"#A78BFA",email:this.elementColors.email||"#34D399",phone:this.elementColors.phone||"#FB923C",sns:this.elementColors.sns||"#F472B6",website:this.elementColors.website||"#FBBF24"},1)}createBlocksFromBusinessCard(t,e,i,s=1,a="standard"){switch(this.blocks=[],a){case"standard":this.createStandardLayout(t,e,i,s);break;case"professional":this.createProfessionalLayout(t,e,i,s);break;case"minimal":this.createMinimalLayout(t,e,i,s);break}}generateBlocksFromCanvas(t,e,i,s,a,n,l=1){const o=t.getContext("2d",{willReadFrequently:!0});if(!o)return;const c=o.getImageData(0,0,t.width,t.height).data,u=1/this.dpr,b=t.width*u,C=t.height*u,B=(e-b)/2,S=(i-C)/2,v=x=>{for(const r of a)if(x>=r.start&&x<=r.end)return n[r.type]||"#FFFFFF";if(a.length===0)return"#FFFFFF";const d=a.reduce((r,m)=>{const M=(m.start+m.end)/2,T=Math.abs(x-M),w=(r.start+r.end)/2,R=Math.abs(x-w);return T<R?m:r},a[0]);return n[d==null?void 0:d.type]||"#FFFFFF"},g=Math.max(1,Math.round(s*this.dpr)),E=l,F=20,f=new Set;for(let x=0;x<t.height;x+=g){const d=x*u,r=v(d);for(let m=0;m<t.width;m+=g){const M=Math.min(x+Math.floor(g/2),t.height-1),T=Math.min(m+Math.floor(g/2),t.width-1),w=(M*t.width+T)*4;if(c[w+3]>F){const R=Math.round(m*u),k=Math.round(B+R),L=Math.round(S+d),A=`${k},${L}`;if(f.has(A))continue;f.add(A),this.blocks.push({x:k,y:L,width:E,height:E,text:"",isDestroyed:!1,destroyedAt:0,color:r,fontSize:0,fontFamily:""})}}}console.log(`Generated ${this.blocks.length} blocks`)}destroyBlock(t,e){return t>=0&&t<this.blocks.length&&!this.blocks[t].isDestroyed?(this.blocks[t].isDestroyed=!0,this.blocks[t].destroyedAt=e,!0):!1}getBlockRecoveryState(t,e){if(!t.isDestroyed)return{isDestroyed:!1,alpha:1};const i=e-t.destroyedAt;if(i<this.blockRecoveryTime)return{isDestroyed:!0,alpha:0};const s=i-this.blockRecoveryTime;return s<this.blockFadeInTime?{isDestroyed:!1,alpha:s/this.blockFadeInTime}:{isDestroyed:!1,alpha:1}}updateBlockRecovery(t){this.blocks.forEach(e=>{e.isDestroyed&&t-e.destroyedAt>=this.blockRecoveryTime+this.blockFadeInTime&&(e.isDestroyed=!1)})}checkCollision(t,e,i){for(let s=0;s<this.blocks.length;s++){const a=this.blocks[s];if(a.isDestroyed)continue;const n=Math.max(a.x,Math.min(t,a.x+a.width)),l=Math.max(a.y,Math.min(e,a.y+a.height)),o=t-n,h=e-l;if(o*o+h*h<i*i)return s}return-1}allBlocksDestroyed(){return this.blocks.every(t=>t.isDestroyed)}reset(){this.blocks.forEach(t=>{t.isDestroyed=!1,t.destroyedAt=0})}setBlockRecoveryTime(t){this.blockRecoveryTime=t}setBlockFadeInTime(t){this.blockFadeInTime=t}}class H{constructor(){p(this,"particles",[])}getParticles(){return this.particles}createBlockDestructionEffect(t,e,i,s=12){for(let a=0;a<s;a++){const n=a/s*Math.PI*2,l=3+Math.random()*4,o=Math.cos(n)*l,h=Math.sin(n)*l;this.particles.push({x:t,y:e,vx:o,vy:h,life:1,maxLife:1,color:i,size:4+Math.random()*4})}}createImpactEffect(t,e,i,s=8){for(let a=0;a<s;a++){const n=a/s*Math.PI*2+(Math.random()-.5)*.5,l=2+Math.random()*3,o=Math.cos(n)*l,h=Math.sin(n)*l;this.particles.push({x:t,y:e,vx:o,vy:h,life:1,maxLife:1,color:i,size:2+Math.random()*3})}}update(){this.particles=this.particles.filter(t=>(t.life-=.05,t.x+=t.vx,t.y+=t.vy,t.vy+=.2,t.vx*=.98,t.life>0))}clear(){this.particles=[]}}class K{constructor(t,e=1){p(this,"ctx");const i=t.getContext("2d");if(!i)throw new Error("Failed to get 2D context from canvas");this.ctx=i,this.ctx.scale(e,e)}drawBackground(t,e){const i=this.ctx.createLinearGradient(0,0,0,e);i.addColorStop(0,"#1a1a2e"),i.addColorStop(1,"#16213e"),this.ctx.fillStyle=i,this.ctx.fillRect(0,0,t,e)}drawBlocks(t,e,i){t.forEach(s=>{const a=i.getBlockRecoveryState(s,e);if(!(a.isDestroyed&&a.alpha===0)){if(this.ctx.save(),this.ctx.globalAlpha=a.alpha,this.ctx.fillStyle=s.color,this.ctx.fillRect(s.x,s.y,s.width,s.height),!s.text||s.text.length===0){if(a.alpha<1){const n=this.ctx.createLinearGradient(s.x,s.y,s.x,s.y+s.height);n.addColorStop(0,`rgba(255, 255, 255, ${.3*a.alpha})`),n.addColorStop(1,"rgba(255, 255, 255, 0)"),this.ctx.fillStyle=n,this.ctx.fillRect(s.x,s.y,s.width,s.height)}s.width>3&&(this.ctx.strokeStyle=`rgba(255, 255, 255, ${.1*a.alpha})`,this.ctx.lineWidth=.5,this.ctx.strokeRect(s.x,s.y,s.width,s.height))}else{this.ctx.strokeStyle=`rgba(255, 255, 255, ${.3*a.alpha})`,this.ctx.lineWidth=2,this.ctx.strokeRect(s.x,s.y,s.width,s.height);const n=this.ctx.createLinearGradient(s.x,s.y,s.x,s.y+s.height);n.addColorStop(0,`rgba(255, 255, 255, ${.2*a.alpha})`),n.addColorStop(.5,"rgba(255, 255, 255, 0)"),n.addColorStop(1,`rgba(0, 0, 0, ${.1*a.alpha})`),this.ctx.fillStyle=n,this.ctx.fillRect(s.x,s.y,s.width,s.height),this.ctx.fillStyle="#ffffff",this.ctx.font=`bold ${s.fontSize}px ${s.fontFamily}`,this.ctx.textAlign="center",this.ctx.textBaseline="middle";const l=s.x+s.width/2,o=s.y+s.height/2;let h=s.text;s.text.length>10&&(h=s.text.substring(0,10)+"..."),this.ctx.shadowColor="rgba(0, 0, 0, 0.5)",this.ctx.shadowBlur=4,this.ctx.shadowOffsetX=2,this.ctx.shadowOffsetY=2,this.ctx.fillText(h,l,o)}this.ctx.restore()}})}drawBall(t){this.ctx.save(),this.ctx.fillStyle="#FFD700",this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.radius,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="rgba(255, 255, 255, 0.4)",this.ctx.beginPath(),this.ctx.arc(t.x-t.radius/3,t.y-t.radius/3,t.radius/3,0,Math.PI*2),this.ctx.fill(),this.ctx.restore()}drawPaddle(t){this.ctx.save();const e=this.ctx.createLinearGradient(t.x,t.y,t.x,t.y+t.height);e.addColorStop(0,"#D4D4D4"),e.addColorStop(1,"#CCCCCC"),this.ctx.fillStyle=e,this.ctx.fillRect(t.x,t.y,t.width,t.height),this.ctx.strokeStyle="#FFFFFF",this.ctx.lineWidth=2,this.ctx.strokeRect(t.x,t.y,t.width,t.height),this.ctx.restore()}drawParticles(t){t.forEach(e=>{this.ctx.save(),this.ctx.globalAlpha=e.life,this.ctx.fillStyle=e.color,this.ctx.beginPath(),this.ctx.arc(e.x,e.y,e.size,0,Math.PI*2),this.ctx.fill(),this.ctx.restore()})}drawScore(t,e,i,s=20,a=30){this.ctx.save(),this.ctx.fillStyle="#FFFFFF";const n=i*.05;this.ctx.font=`${n}px "Bitcount Prop Single"`,this.ctx.textAlign="left",s=e*.02,a=i*.05,this.ctx.fillText(`Score: ${t}`,s,a),this.ctx.restore()}drawGameOver(t,e,i){this.ctx.save(),this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(0,0,t,e);const s=Math.min(48,t*.12),a=Math.min(24,t*.06);this.ctx.fillStyle="#FFFFFF",this.ctx.font=`bold ${s}px "Bitcount Prop Single"`,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("THANKS FOR",t/2,e/2-60),this.ctx.fillText("CONNECTING!",t/2,e/2-60+s),this.ctx.font=`${a}px "Bitcount Prop Single"`,this.ctx.fillText(`Score: ${i}`,t/2,e/2-60+s+2*a),this.ctx.font=`${a}px "Bitcount Prop Single"`,this.ctx.fillText("Tap or Press R to restart",t/2,e/2+s+4+s),this.ctx.restore()}drawGameClear(t,e,i){this.ctx.save(),this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(0,0,t,e);const s=Math.min(48,t*.12),a=Math.min(24,t*.06);this.ctx.fillStyle="#FFD700",this.ctx.font=`bold ${s}px "Bitcount Prop Single"`,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("PERFECT!",t/2,e/2-60),this.ctx.fillText("LET'S CONNECT!",t/2,e/2-60+s),this.ctx.fillStyle="#FFFFFF",this.ctx.font=`${a}px "Bitcount Prop Single"`,this.ctx.fillText(`Final Score: ${i}`,t/2,e/2-60+s+2*a),this.ctx.font=`${a}px "Bitcount Prop Single"`,this.ctx.fillText("Tap or Press R to restart",t/2,e/2-60+s+4*a),this.ctx.restore()}clear(t,e){this.ctx.clearRect(0,0,t,e)}}const P={name:"山田　太郎",nameEn:"Taro Yamada",title:"Senior Software Engineer",tagline:"Building the future, one line at a time.",company:"Tech Solutions Inc.",email:"taro.yamada@example.com",phone:"+81-90-0000-0000",sns:"https://example.com/taroy",website:"https://www.example.com/"},I={paddleWidthRatio:.4,paddleSpeedRatio:.015,ballSpeedRatio:.009,ballRadiusRatio:.012,paddleHeight:4,gravity:0,friction:1,blockRecoveryTime:1e4,effectDuration:5e3,destructionRadius:30},_="standard",q={company:"#60A5FA",tagline:"#C084FC",name:"#F16584",nameEn:"#34D399",title:"#A78BFA",email:"#4ECDC4",phone:"#FB923C",sns:"#EC4899",website:"#FBBF24"};class j{constructor(t,e){p(this,"canvas");p(this,"config");p(this,"ball");p(this,"paddle");p(this,"blockManager");p(this,"particleSystem");p(this,"renderer");p(this,"gameRunning",!1);p(this,"gamePaused",!1);p(this,"gameOver",!1);p(this,"gameCleared",!1);p(this,"score",0);p(this,"animationFrameId",null);p(this,"lastTime",0);p(this,"frameCount",0);p(this,"lastFpsUpdate",0);p(this,"currentFps",0);p(this,"pointerX",0);p(this,"lastPointerMoveTime",0);p(this,"gameLoop",()=>{const t=performance.now(),e=t-this.lastTime;this.lastTime=t;const i=performance.now();this.gamePaused||this.update(t);const s=performance.now()-i,a=performance.now();this.render();const n=performance.now()-a;this.frameCount++,t-this.lastFpsUpdate>=1e3&&(this.currentFps=Math.round(this.frameCount*1e3/(t-this.lastFpsUpdate)),console.log(`FPS: ${this.currentFps} | Update: ${s.toFixed(2)}ms | Render: ${n.toFixed(2)}ms | Frame Time: ${e.toFixed(2)}ms `),this.frameCount=0,this.lastFpsUpdate=t),this.gamePaused||this.update(t),this.render(),this.gameRunning&&!this.gameOver&&!this.gameCleared&&(this.animationFrameId=requestAnimationFrame(this.gameLoop))});this.canvas=t;const i=(e==null?void 0:e.width)||t.width,s=(e==null?void 0:e.height)||t.height,a=(e==null?void 0:e.paddleWidthRatio)??.4,n=(e==null?void 0:e.paddleSpeedRatio)??.015,l=(e==null?void 0:e.ballSpeedRatio)??.009,o=(e==null?void 0:e.ballRadiusRatio)??.012,h=Math.floor(i*a),c=Math.max(i*n,5),u=Math.max(i*l,3),b=Math.max(i*o,4);this.config={width:i,height:s,paddleSpeed:c,ballSpeed:u,ballRadius:b,paddleHeight:4,paddleWidthRatio:a,paddleWidth:h,gravity:0,friction:1,blockRecoveryTime:1e4,effectDuration:5e3,destructionRadius:30,dpr:1,...e};const C=this.config.dpr||1;console.log("GameEngine.tsのdpr:",C),this.ball=new N(this.config.width/2,this.config.height/2,this.config.ballRadius,this.config.ballSpeed),this.paddle=new X(this.config.width/2-this.config.paddleWidth/2,this.config.height-this.config.paddleHeight-1,this.config.paddleWidth,this.config.paddleHeight,this.config.paddleSpeed),this.blockManager=new U(this.config.blockRecoveryTime,this.config.effectDuration,C,q),this.particleSystem=new H,this.renderer=new K(t,C),this.setupEventListeners()}setupEventListeners(){this.canvas.addEventListener("mousemove",t=>{const e=this.canvas.getBoundingClientRect();this.pointerX=t.clientX-e.left,this.lastPointerMoveTime=performance.now()}),this.canvas.addEventListener("touchmove",t=>{const e=this.canvas.getBoundingClientRect();this.pointerX=t.touches[0].clientX-e.left,this.lastPointerMoveTime=performance.now()}),this.canvas.addEventListener("click",()=>{!this.gameRunning&&!this.gameOver&&!this.gameCleared?this.start():(this.gameOver||this.gameCleared)&&this.restart()}),this.canvas.addEventListener("touchstart",t=>{t.preventDefault(),!this.gameRunning&&!this.gameOver&&!this.gameCleared?this.start():(this.gameOver||this.gameCleared)&&this.restart()}),window.addEventListener("keydown",t=>{(t.key==="r"||t.key==="R")&&(this.gameOver||this.gameCleared)&&this.restart(),t.key===" "&&(!this.gameRunning&&!this.gameOver&&!this.gameCleared?this.start():this.gameRunning&&this.togglePause())}),this.canvas.addEventListener("click",()=>{!this.gameRunning&&!this.gameOver&&!this.gameCleared&&this.start()})}isPointerActive(){return performance.now()-this.lastPointerMoveTime<500}initializeWithBusinessCard(t,e="standard"){console.log("initializeWithBusinessCard called:",{layout:e,stackTrace:new Error().stack}),this.blockManager.createBlocksFromBusinessCard(t,this.config.width,this.config.height,1,e),this.resetGameState()}start(){if(this.gameRunning)return;this.gameRunning=!0,this.gamePaused=!1;const t=(Math.random()-.5)*Math.PI/2;this.ball.setVelocity(Math.cos(t)*this.config.ballSpeed,-Math.abs(Math.sin(t)*this.config.ballSpeed)),this.lastTime=performance.now(),this.lastFpsUpdate=this.lastTime,this.frameCount=0,this.gameLoop()}togglePause(){this.gamePaused=!this.gamePaused}restart(){this.resetGameState(),this.blockManager.reset(),this.score=0,this.gameRunning=!1,this.gamePaused=!1,this.gameOver=!1,this.gameCleared=!1,this.particleSystem.clear(),this.render()}resetGameState(){const t=this.config.width-50;this.ball.reset(t,50),this.paddle.reset(this.config.width/2-this.config.paddleWidth/2,this.config.height-this.config.paddleHeight-1)}update(t){this.paddle.update(this.config.width,this.config.paddleSpeed),this.isPointerActive()&&!this.paddle.isKeyboardActive()&&this.paddle.updateFromPointer(this.pointerX,this.config.width),this.ball.update(),this.ball.checkWallCollision(this.config.width,this.config.height),this.ball.checkPaddleCollision(this.paddle.getPaddle().x,this.paddle.getPaddle().y,this.paddle.getPaddle().width,this.paddle.getPaddle().height),this.blockManager.updateBlockRecovery(t);const e=this.blockManager.checkCollision(this.ball.getBall().x,this.ball.getBall().y,this.ball.getBall().radius);if(e!==-1){const i=this.blockManager.getBlocks()[e];i.isDestroyed||(this.blockManager.destroyBlock(e,t),this.particleSystem.createBlockDestructionEffect(i.x+i.width/2,i.y+i.height/2,i.color,15),this.score+=10,this.destroyNearbyBlocks(this.ball.getBall().x,this.ball.getBall().y,this.ball.getBall().radius*.5,t),this.ball.checkBlockCollision(i.x,i.y,i.width,i.height).collided&&this.particleSystem.createImpactEffect(this.ball.getBall().x,this.ball.getBall().y,i.color,8))}this.particleSystem.update(),this.ball.getBall().y>this.config.height+50&&(this.gameOver=!0,this.gameRunning=!1),this.blockManager.allBlocksDestroyed()&&(this.gameCleared=!0,this.gameRunning=!1)}destroyNearbyBlocks(t,e,i,s){this.blockManager.getBlocks().forEach((n,l)=>{if(n.isDestroyed)return;const o=n.x+n.width/2,h=n.y+n.height/2,c=o-t,u=h-e;Math.sqrt(c*c+u*u)<i*2&&(this.blockManager.destroyBlock(l,s),Math.random()<.3&&this.particleSystem.createBlockDestructionEffect(o,h,n.color,3),this.score+=5)})}render(){this.renderer.clear(this.config.width,this.config.height),this.renderer.drawBackground(this.config.width,this.config.height);const t=performance.now();this.renderer.drawBlocks(this.blockManager.getBlocks(),t,this.blockManager),this.renderer.drawBall(this.ball.getBall()),this.renderer.drawPaddle(this.paddle.getPaddle()),this.renderer.drawParticles(this.particleSystem.getParticles()),this.renderer.drawScore(this.score,this.config.width,this.config.height),this.gameOver?this.renderer.drawGameOver(this.config.width,this.config.height,this.score):this.gameCleared&&this.renderer.drawGameClear(this.config.width,this.config.height,this.score)}stop(){this.gameRunning=!1,this.animationFrameId!==null&&cancelAnimationFrame(this.animationFrameId)}getScore(){return this.score}getGameState(){return{running:this.gameRunning,paused:this.gamePaused,gameOver:this.gameOver,cleared:this.gameCleared}}}function V(y,t,e,i="standard",s=!1){const a=document.getElementById(y);if(!a)throw new Error(`Container with ID "${y}" not found`);const n=91/55,l=300,o=910;let h=a.clientWidth||600;h=Math.max(l,Math.min(o,h));let c=h,u=h/n;(!a.style.height||a.style.height==="0px")&&(a.style.height=`${u}px`),c=Math.floor(c/8)*8,u=Math.floor(u/8)*8;const b=window.devicePixelRatio||1,C=Math.floor(c*b/8)*8,B=Math.floor(u*b/8)*8,S=document.createElement("canvas");S.width=C,S.height=B,S.style.width=`${c}px`,S.style.height=`${u}px`,S.style.display="block",S.style.backgroundColor="#1a1a2e",S.style.borderRadius="8px",S.style.boxShadow="0 4px 6px rgba(0, 0, 0, 0.3)",S.style.margin="0 auto",a.appendChild(S);const v={...I,...e,width:c,height:u,dpr:b};console.log("index.tsのdpr:",b);const g=new j(S,v),E={...P,...t};return g.initializeWithBusinessCard(E,i),s&&g.start(),g}let D=null;const J={name:"nameInput",nameEn:"nameEnInput",title:"titleInput",tagline:"taglineInput",company:"companyInput",email:"emailInput",phone:"phoneInput",sns:"snsInput",website:"websiteInput"},Q=["standard","professional","minimal"],Z=()=>{document.getElementById("nameInput").value=P.name,document.getElementById("nameEnInput").value=P.nameEn,document.getElementById("titleInput").value=P.title,document.getElementById("taglineInput").value=P.tagline,document.getElementById("companyInput").value=P.company,document.getElementById("emailInput").value=P.email,document.getElementById("phoneInput").value=P.phone,document.getElementById("snsInput").value=P.sns,document.getElementById("websiteInput").value=P.website,document.getElementById("layoutSelect").value=_},z=()=>({name:document.getElementById("nameInput").value,nameEn:document.getElementById("nameEnInput").value,title:document.getElementById("titleInput").value,tagline:document.getElementById("taglineInput").value,company:document.getElementById("companyInput").value,email:document.getElementById("emailInput").value,phone:document.getElementById("phoneInput").value,sns:document.getElementById("snsInput").value,website:document.getElementById("websiteInput").value}),O=(y,t)=>{const e=document.getElementById("gameContainer");e.innerHTML="",D=V("gameContainer",y,I,t,!1),D.start()};window.startGame=function(){const y=z(),t=document.getElementById("layoutSelect").value;D&&D.stop(),O(y,t)};const tt=()=>{const y=new URLSearchParams(window.location.search);let t=!1;Object.entries(J).forEach(([i,s])=>{if(!y.has(i))return;const a=document.getElementById(s);a&&(a.value=y.get(i)||"",t=!0)});const e=y.get("layout");return e&&Q.includes(e)&&(document.getElementById("layoutSelect").value=e,t=!0),t},et=(y,t)=>{const e=new URLSearchParams;Object.entries(y).forEach(([s,a])=>{typeof a=="string"&&a.trim().length>0&&e.set(s,a.trim())}),t&&e.set("layout",t);const i=new URL(window.location.href);return i.search=e.toString(),i.hash="",i.toString()},st=y=>{const t=document.createElement("textarea");t.value=y,t.style.position="fixed",t.style.top="-1000px",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy")}finally{document.body.removeChild(t)}};window.shareBusinessCard=async function(){const y=z(),t=document.getElementById("layoutSelect").value,e=et(y,t);if(navigator.share)try{await navigator.share({title:"Business Card Breakout",text:"名刺ゲームを共有しました！",url:e});return}catch(i){if(i.name==="AbortError")return;console.warn("Web Share API failed, fallback to clipboard.",i)}try{navigator.clipboard&&window.isSecureContext?await navigator.clipboard.writeText(e):st(e),alert("共有リンクをクリップボードにコピーしました！")}catch(i){console.warn("Clipboard API failed, fallback to alert.",i),alert(`共有リンクをコピーできませんでした。
${e}`)}};window.addEventListener("load",()=>{tt()||Z();const t=z(),e=document.getElementById("layoutSelect").value;O(t,e)});
