var z=Object.defineProperty;var D=(x,t,e)=>t in x?z(x,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):x[t]=e;var p=(x,t,e)=>D(x,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const n of a.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function e(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=e(s);fetch(s.href,a)}})();class W{constructor(t,e,i,s=6){p(this,"ball");p(this,"baseSpeed");this.ball={x:t,y:e,vx:0,vy:0,radius:i},this.baseSpeed=s}getBall(){return this.ball}update(){this.ball.x+=this.ball.vx,this.ball.y+=this.ball.vy;const t=Math.sqrt(this.ball.vx*this.ball.vx+this.ball.vy*this.ball.vy);if(t<this.baseSpeed&&t>0){const e=this.baseSpeed/t;this.ball.vx*=e,this.ball.vy*=e}}setVelocity(t,e){this.ball.vx=t,this.ball.vy=e}checkWallCollision(t,e){this.ball.x-this.ball.radius<0&&(this.ball.x=this.ball.radius,this.ball.vx=Math.abs(this.ball.vx)),this.ball.x+this.ball.radius>t&&(this.ball.x=t-this.ball.radius,this.ball.vx=-Math.abs(this.ball.vx)),this.ball.y-this.ball.radius<0&&(this.ball.y=this.ball.radius,this.ball.vy=Math.abs(this.ball.vy))}reset(t,e){this.ball.x=t,this.ball.y=e,this.ball.vx=0,this.ball.vy=0}checkPaddleCollision(t,e,i,s){if(this.ball.y+this.ball.radius>=e&&this.ball.y-this.ball.radius<=e+s&&this.ball.x+this.ball.radius>=t&&this.ball.x-this.ball.radius<=t+i){const n=((this.ball.x-t)/i-.5)*Math.PI*.7;return this.ball.vx=Math.sin(n)*this.baseSpeed,this.ball.vy=-Math.abs(Math.cos(n)*this.baseSpeed),this.ball.y=e-this.ball.radius,!0}return!1}checkBlockCollision(t,e,i,s){const a=Math.max(t,Math.min(this.ball.x,t+i)),n=Math.max(e,Math.min(this.ball.y,e+s)),o=this.ball.x-a,h=this.ball.y-n,u=o*o+h*h;if(u<this.ball.radius*this.ball.radius){const l=Math.sqrt(u),c=l>0?o/l:0,F=l>0?h/l:0,b=this.ball.radius-l;this.ball.x+=c*b,this.ball.y+=F*b;const f=this.ball.vx*c+this.ball.vy*F;return this.ball.vx=this.ball.vx-2*f*c,this.ball.vy=this.ball.vy-2*f*F,{collided:!0,normal:{x:c,y:F}}}return{collided:!1,normal:{x:0,y:0}}}}class L{constructor(t,e,i,s,a=8){p(this,"paddle");p(this,"keysPressed",new Map);p(this,"lastKeyPressTime",0);this.paddle={x:t,y:e,width:i,height:s,vx:0},this.setupKeyListeners()}getPaddle(){return this.paddle}getWidth(){return this.paddle.width}setupKeyListeners(){typeof window>"u"||(window.addEventListener("keydown",t=>{const e=t.key.toLowerCase();this.keysPressed.set(e,!0),(e==="arrowleft"||e==="arrowright"||e==="a"||e==="d")&&(this.lastKeyPressTime=performance.now())}),window.addEventListener("keyup",t=>{this.keysPressed.set(t.key.toLowerCase(),!1)}))}isKeyboardActive(){return performance.now()-this.lastKeyPressTime<500}update(t,e){this.paddle.vx=0,(this.keysPressed.get("arrowleft")||this.keysPressed.get("a"))&&(this.paddle.vx=-e,this.lastKeyPressTime=performance.now()),(this.keysPressed.get("arrowright")||this.keysPressed.get("d"))&&(this.paddle.vx=e,this.lastKeyPressTime=performance.now()),this.paddle.x+=this.paddle.vx,this.paddle.x<0&&(this.paddle.x=0),this.paddle.x+this.paddle.width>t&&(this.paddle.x=t-this.paddle.width)}updateFromPointer(t,e){const i=t-this.paddle.width/2;this.paddle.x=Math.max(0,Math.min(i,e-this.paddle.width))}reset(t,e){this.paddle.x=t,this.paddle.y=e,this.paddle.vx=0}}class O{constructor(t=5e3,e=1e3,i=1,s={}){p(this,"blocks",[]);p(this,"blockRecoveryTime");p(this,"blockFadeInTime");p(this,"dpr",1);p(this,"elementColors");this.blockRecoveryTime=t,this.blockFadeInTime=e,this.dpr=i,this.elementColors=s}getBlocks(){return this.blocks}calculateFontSize(t,e,i=16){const s=e*t*this.dpr;return Math.max(Math.round(s),i)}calculateCanvasSize(t,e){const i=e*t*this.dpr;return Math.round(i)}drawTextFitToWidth(t,e,i,s,a,n,o,h="left"){t.font=`${n}px ${o}`;const u=t.measureText(e).width;if(u<=a)return t.textAlign=h,t.fillText(e,i,s),n;const l=a/u;t.save();const c=i/l;return t.scale(l,1),t.textAlign=h,t.fillText(e,c,s),t.restore(),n}getFontFamily(t){const e=/[\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]/.test(t),i=/[\u4E00-\u9FFF]/.test(t)&&!e,s=/[\uAC00-\uD7AF\u1100-\u11FF]/.test(t),a=/[\u0E00-\u0E7F]/.test(t),n=/[\u0600-\u06FF]/.test(t),o=/[\u0400-\u04FF]/.test(t);return e?'"DotGothic16", monospace':i?'"ZCOOL QingKe HuangYou", "Noto Sans SC", sans-serif':s?'"Noto Sans KR", sans-serif':a?'"Noto Sans Thai", sans-serif':n?'"Noto Sans Arabic", sans-serif':o?'"Silkscreen", "Press Start 2P", monospace':'"Bitcount Prop Single", "DotGothic16", monospace'}createStandardLayout(t,e,i,s){const a=document.createElement("canvas"),n=a.getContext("2d",{willReadFrequently:!0});if(!n)return;n.imageSmoothingEnabled=!0;const o=this.calculateCanvasSize(.08,i),h=this.calculateCanvasSize(.85,e),u=this.calculateCanvasSize(.81,i);console.log("createStandardLayout:",{canvasWidth:e,canvasHeight:i,padding:o,tempWidth:h,tempHeight:u,dpr:this.dpr}),a.width=h,a.height=u,n.imageSmoothingEnabled=!0,n.clearRect(0,0,a.width,a.height),n.fillStyle="#FFFFFF";let l=o;const c=[];if(t.name){const f=this.calculateFontSize(.095,i,16);console.log("fontSize:",f);const r=l,d=this.getFontFamily(t.name),g=h-o*2;n.textBaseline="top";const y=this.drawTextFitToWidth(n,t.name,o,l,g,f,d,"left");c.push({start:r,end:r+y,type:"name"}),l+=y*1.5}if(t.title){const f=this.calculateFontSize(.055,i,16),r=l,d=this.getFontFamily(t.title),g=h-o*2;n.textBaseline="top";const y=this.drawTextFitToWidth(n,t.title,o,l,g,f,d,"left");c.push({start:r,end:r+y,type:"title"}),l+=y*1.6}if(t.company){const f=this.calculateFontSize(.065,i,16),r=l,d=this.getFontFamily(t.company),g=h-o*2;n.textBaseline="top";const y=this.drawTextFitToWidth(n,t.company,o,l,g,f,d,"left");c.push({start:r,end:r+y,type:"company"}),l+=y*1.8}const F=this.calculateFontSize(.04,i,16),b=h-o*2;n.textBaseline="top",[{data:t.email,type:"email"},{data:t.phone,type:"phone"},{data:t.sns,type:"sns"},{data:t.website,type:"website"}].forEach(f=>{if(f.data){const r=l,d=this.getFontFamily(f.data),g=this.drawTextFitToWidth(n,f.data,o,l,b,F,d,"left");c.push({start:r,end:r+g,type:f.type}),l+=g*1.4}}),this.generateBlocksFromCanvas(a,e,i,s,c,{company:this.elementColors.company||"#60A5FA",name:this.elementColors.name||"#FF6B8A",title:this.elementColors.titleEn||"#A78BFA",email:this.elementColors.email||"#34D399",phone:this.elementColors.phone||"#FB923C",sns:this.elementColors.sns||"#F472B6",website:this.elementColors.website||"#FBBF24"},1)}createProfessionalLayout(t,e,i,s){const a=document.createElement("canvas"),n=a.getContext("2d",{willReadFrequently:!0});if(!n)return;n.imageSmoothingEnabled=!0;const o=this.calculateCanvasSize(.08,i),h=this.calculateCanvasSize(.85,e),u=this.calculateCanvasSize(.81,i);console.log("createProfessionalLayout:",{canvasWidth:e,canvasHeight:i,padding:o,tempWidth:h,tempHeight:u,dpr:this.dpr}),a.width=h,a.height=u,n.imageSmoothingEnabled=!0,n.clearRect(0,0,a.width,a.height),n.fillStyle="#FFFFFF";let l=o;const c=[];if(t.company){const r=this.calculateFontSize(.08,i,12),d=l,g=this.getFontFamily(t.company),y=h-o*2;n.textBaseline="top";const m=this.drawTextFitToWidth(n,t.company,h/2,l,y,r,g,"center");c.push({start:d,end:d+m,type:"company"}),l+=m*1.3}if(t.tagline){const r=this.calculateFontSize(.035,i,16),d=l,g=this.getFontFamily(t.tagline),y=h-o*2;n.textBaseline="top";const m=this.drawTextFitToWidth(n,t.tagline,h/2,l,y,r,g,"center");c.push({start:d,end:d+m,type:"tagline"}),l+=m*2}if(t.name){const r=this.calculateFontSize(.11,i,16),d=l,g=this.getFontFamily(t.name),y=h-o*2;n.textBaseline="top";const m=this.drawTextFitToWidth(n,t.name,o,l,y,r,g,"left");c.push({start:d,end:d+m,type:"name"}),l+=m*1.4}if(t.nameEn){const r=this.calculateFontSize(.05,i,16),d=l,g=this.getFontFamily(t.nameEn),y=h-o*2;n.textBaseline="top";const m=this.drawTextFitToWidth(n,t.nameEn,o,l,y,r,g,"left");c.push({start:d,end:d+m,type:"nameEn"}),l+=m*1.5}if(t.title){const r=this.calculateFontSize(.048,i,16),d=l,g=this.getFontFamily(t.title),y=h-o*2;n.textBaseline="top";const m=this.drawTextFitToWidth(n,t.title,o,l,y,r,g,"left");c.push({start:d,end:d+m,type:"title"}),l+=m*2}const F=this.calculateFontSize(.038,i,16),b=.15,f=.02;[{label:"Email",data:t.email,type:"email"},{label:"Phone",data:t.phone,type:"phone"},{label:"SNS",data:t.sns,type:"sns"},{label:"Website",data:t.website,type:"website"}].forEach(r=>{if(r.data){const d=l,g=this.getFontFamily(r.label),y=this.getFontFamily(r.data);n.textBaseline="top";const m=h-o*2,S=m*b,w=m*f,B=m-S-w,v=this.drawTextFitToWidth(n,r.label,o,l,S,F,g,"left"),M=o+S+w,P=this.drawTextFitToWidth(n,r.data,M,l,B,F,y,"left"),E=Math.max(v,P);c.push({start:d,end:d+E,type:r.type}),l+=E*1.4}}),this.generateBlocksFromCanvas(a,e,i,s,c,{company:this.elementColors.company||"#60A5FA",tagline:this.elementColors.tagline||"#A78BFA",name:this.elementColors.name||"#FF6B8A",nameEn:this.elementColors.nameEn||"#4ECDC4",title:this.elementColors.titleEn||"#A78BFA",email:this.elementColors.email||"#34D399",phone:this.elementColors.phone||"#FB923C",sns:this.elementColors.sns||"#F472B6",website:this.elementColors.website||"#FBBF24"},1)}createMinimalLayout(t,e,i,s){const a=document.createElement("canvas"),n=a.getContext("2d",{willReadFrequently:!0});if(!n)return;n.imageSmoothingEnabled=!0;const o=this.calculateCanvasSize(.08,i),h=this.calculateCanvasSize(.8,e),u=this.calculateCanvasSize(.81,i);console.log("createMinimalLayout:",{canvasWidth:e,canvasHeight:i,padding:o,tempWidth:h,tempHeight:u,dpr:this.dpr}),a.width=h,a.height=u,n.imageSmoothingEnabled=!0,n.clearRect(0,0,a.width,a.height),n.fillStyle="#FFFFFF";let l=o;const c=[];if(t.name){const r=this.calculateFontSize(.12,i,16),d=l,g=this.getFontFamily(t.name),y=h-o*2;n.textBaseline="top";const m=this.drawTextFitToWidth(n,t.name,h/2,l,y,r,g,"center");c.push({start:d,end:d+m,type:"name"}),l+=m*1.6}const F=[t.title,t.company].filter(Boolean).join(" | ");if(F){const r=this.calculateFontSize(.045,i,16),d=l,g=this.getFontFamily(F),y=h-o*2;n.textBaseline="top";const m=this.drawTextFitToWidth(n,F,h/2,l,y,r,g,"center");c.push({start:d,end:d+m,type:"title"}),l+=m*2.5}const b=this.calculateFontSize(.035,i,16),f=h-o*2;n.textBaseline="top",[{data:t.email,type:"email"},{data:t.phone,type:"phone"},{data:t.sns,type:"sns"},{data:t.website,type:"website"}].forEach(r=>{if(r.data){const d=l,g=this.getFontFamily(r.data),y=this.drawTextFitToWidth(n,r.data,h/2,l,f,b,g,"center");c.push({start:d,end:d+y,type:r.type}),l+=y*1.6}}),this.generateBlocksFromCanvas(a,e,i,s,c,{name:this.elementColors.name||"#FF6B8A",title:this.elementColors.titleEn||"#A78BFA",email:this.elementColors.email||"#34D399",phone:this.elementColors.phone||"#FB923C",sns:this.elementColors.sns||"#F472B6",website:this.elementColors.website||"#FBBF24"},1)}createBlocksFromBusinessCard(t,e,i,s=1,a="standard"){switch(this.blocks=[],a){case"standard":this.createStandardLayout(t,e,i,s);break;case"professional":this.createProfessionalLayout(t,e,i,s);break;case"minimal":this.createMinimalLayout(t,e,i,s);break}}generateBlocksFromCanvas(t,e,i,s,a,n,o=1){const h=t.getContext("2d");if(!h)return;const l=h.getImageData(0,0,t.width,t.height).data,c=1/this.dpr;console.log("generateBlocksFromCanvas:",{tempCanvasSize:`${t.width}x${t.height}`,gameCanvasSize:`${e}x${i}`,dpr:this.dpr,dprScale:c});const F=t.width*c,b=t.height*c,f=(e-F)/2,r=(i-b)/2,d=m=>{for(const w of a)if(m>=w.start&&m<=w.end)return n[w.type]||"#FFFFFF";const S=a.reduce((w,B)=>{const v=(B.start+B.end)/2,M=Math.abs(m-v),P=(w.start+w.end)/2,E=Math.abs(m-P);return M<E?B:w},a[0]);return n[S==null?void 0:S.type]||"#FFFFFF"},g=s,y=o;for(let m=0;m<t.height;m+=g)for(let S=0;S<t.width;S+=g){const w=(m*t.width+S)*4;if(l[w+3]>80){const B=S*c,v=m*c;this.blocks.push({x:Math.round(f+B),y:Math.round(r+v),width:y,height:y,text:"",isDestroyed:!1,destroyedAt:0,color:d(m),fontSize:0,fontFamily:""})}}console.log(`Generated ${this.blocks.length} blocks`)}destroyBlock(t,e){return t>=0&&t<this.blocks.length&&!this.blocks[t].isDestroyed?(this.blocks[t].isDestroyed=!0,this.blocks[t].destroyedAt=e,!0):!1}getBlockRecoveryState(t,e){if(!t.isDestroyed)return{isDestroyed:!1,alpha:1};const i=e-t.destroyedAt;if(i<this.blockRecoveryTime)return{isDestroyed:!0,alpha:0};const s=i-this.blockRecoveryTime;return s<this.blockFadeInTime?{isDestroyed:!1,alpha:s/this.blockFadeInTime}:{isDestroyed:!1,alpha:1}}updateBlockRecovery(t){this.blocks.forEach(e=>{e.isDestroyed&&t-e.destroyedAt>=this.blockRecoveryTime+this.blockFadeInTime&&(e.isDestroyed=!1)})}checkCollision(t,e,i){for(let s=0;s<this.blocks.length;s++){const a=this.blocks[s];if(a.isDestroyed)continue;const n=Math.max(a.x,Math.min(t,a.x+a.width)),o=Math.max(a.y,Math.min(e,a.y+a.height)),h=t-n,u=e-o;if(h*h+u*u<i*i)return s}return-1}allBlocksDestroyed(){return this.blocks.every(t=>t.isDestroyed)}reset(){this.blocks.forEach(t=>{t.isDestroyed=!1,t.destroyedAt=0})}setBlockRecoveryTime(t){this.blockRecoveryTime=t}setBlockFadeInTime(t){this.blockFadeInTime=t}}class I{constructor(){p(this,"particles",[])}getParticles(){return this.particles}createBlockDestructionEffect(t,e,i,s=12){for(let a=0;a<s;a++){const n=a/s*Math.PI*2,o=3+Math.random()*4,h=Math.cos(n)*o,u=Math.sin(n)*o;this.particles.push({x:t,y:e,vx:h,vy:u,life:1,maxLife:1,color:i,size:4+Math.random()*4})}}createImpactEffect(t,e,i,s=8){for(let a=0;a<s;a++){const n=a/s*Math.PI*2+(Math.random()-.5)*.5,o=2+Math.random()*3,h=Math.cos(n)*o,u=Math.sin(n)*o;this.particles.push({x:t,y:e,vx:h,vy:u,life:1,maxLife:1,color:i,size:2+Math.random()*3})}}update(){this.particles=this.particles.filter(t=>(t.life-=.05,t.x+=t.vx,t.y+=t.vy,t.vy+=.2,t.vx*=.98,t.life>0))}clear(){this.particles=[]}}class ${constructor(t,e=1){p(this,"ctx");const i=t.getContext("2d");if(!i)throw new Error("Failed to get 2D context from canvas");this.ctx=i,this.ctx.scale(e,e)}drawBackground(t,e){const i=this.ctx.createLinearGradient(0,0,0,e);i.addColorStop(0,"#1a1a2e"),i.addColorStop(1,"#16213e"),this.ctx.fillStyle=i,this.ctx.fillRect(0,0,t,e)}drawBlocks(t,e,i){t.forEach(s=>{const a=i.getBlockRecoveryState(s,e);if(!(a.isDestroyed&&a.alpha===0)){if(this.ctx.save(),this.ctx.globalAlpha=a.alpha,this.ctx.fillStyle=s.color,this.ctx.fillRect(s.x,s.y,s.width,s.height),!s.text||s.text.length===0){if(a.alpha<1){const n=this.ctx.createLinearGradient(s.x,s.y,s.x,s.y+s.height);n.addColorStop(0,`rgba(255, 255, 255, ${.3*a.alpha})`),n.addColorStop(1,"rgba(255, 255, 255, 0)"),this.ctx.fillStyle=n,this.ctx.fillRect(s.x,s.y,s.width,s.height)}s.width>3&&(this.ctx.strokeStyle=`rgba(255, 255, 255, ${.1*a.alpha})`,this.ctx.lineWidth=.5,this.ctx.strokeRect(s.x,s.y,s.width,s.height))}else{this.ctx.strokeStyle=`rgba(255, 255, 255, ${.3*a.alpha})`,this.ctx.lineWidth=2,this.ctx.strokeRect(s.x,s.y,s.width,s.height);const n=this.ctx.createLinearGradient(s.x,s.y,s.x,s.y+s.height);n.addColorStop(0,`rgba(255, 255, 255, ${.2*a.alpha})`),n.addColorStop(.5,"rgba(255, 255, 255, 0)"),n.addColorStop(1,`rgba(0, 0, 0, ${.1*a.alpha})`),this.ctx.fillStyle=n,this.ctx.fillRect(s.x,s.y,s.width,s.height),this.ctx.fillStyle="#ffffff",this.ctx.font=`bold ${s.fontSize}px ${s.fontFamily}`,this.ctx.textAlign="center",this.ctx.textBaseline="middle";const o=s.x+s.width/2,h=s.y+s.height/2;let u=s.text;s.text.length>10&&(u=s.text.substring(0,10)+"..."),this.ctx.shadowColor="rgba(0, 0, 0, 0.5)",this.ctx.shadowBlur=4,this.ctx.shadowOffsetX=2,this.ctx.shadowOffsetY=2,this.ctx.fillText(u,o,h)}this.ctx.restore()}})}drawBall(t){this.ctx.save(),this.ctx.fillStyle="#FFD700",this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.radius,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="rgba(255, 255, 255, 0.4)",this.ctx.beginPath(),this.ctx.arc(t.x-t.radius/3,t.y-t.radius/3,t.radius/3,0,Math.PI*2),this.ctx.fill(),this.ctx.restore()}drawPaddle(t){this.ctx.save();const e=this.ctx.createLinearGradient(t.x,t.y,t.x,t.y+t.height);e.addColorStop(0,"#D4D4D4"),e.addColorStop(1,"#CCCCCC"),this.ctx.fillStyle=e,this.ctx.fillRect(t.x,t.y,t.width,t.height),this.ctx.strokeStyle="#FFFFFF",this.ctx.lineWidth=2,this.ctx.strokeRect(t.x,t.y,t.width,t.height),this.ctx.restore()}drawParticles(t){t.forEach(e=>{this.ctx.save(),this.ctx.globalAlpha=e.life,this.ctx.fillStyle=e.color,this.ctx.beginPath(),this.ctx.arc(e.x,e.y,e.size,0,Math.PI*2),this.ctx.fill(),this.ctx.restore()})}drawScore(t,e=20,i=30){this.ctx.save(),this.ctx.fillStyle="#FFFFFF",this.ctx.font="bold 20px Arial",this.ctx.textAlign="left",this.ctx.fillText(`Score: ${t}`,e,i),this.ctx.restore()}drawGameOver(t,e){this.ctx.save(),this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(0,0,t,e);const i=Math.min(48,t*.12),s=Math.min(24,t*.06);this.ctx.fillStyle="#FFFFFF",this.ctx.font=`bold ${i}px "Bitcount Prop Single"`,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("THANKS FOR",t/2,e/2-60),this.ctx.fillText("CONNECTING!",t/2,e/2-60+i),this.ctx.font=`${s}px "Bitcount Prop Single"`,this.ctx.fillText("Tap or Press R to restart",t/2,e/2+20+i),this.ctx.restore()}drawGameClear(t,e,i){this.ctx.save(),this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(0,0,t,e);const s=Math.min(48,t*.12),a=Math.min(24,t*.06);this.ctx.fillStyle="#FFD700",this.ctx.font=`bold ${s}px "Bitcount Prop Single"`,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("PERFECT!",t/2,e/2-60),this.ctx.fillText("LET'S CONNECT!",t/2,e/2-60+s),this.ctx.fillStyle="#FFFFFF",this.ctx.font=`${a}px "Bitcount Prop Single"`,this.ctx.fillText(`Final Score: ${i}`,t/2,e/2-60+s+2*a),this.ctx.font=`${a}px "Bitcount Prop Single"`,this.ctx.fillText("Tap or Press R to restart",t/2,e/2-60+s+4*a),this.ctx.restore()}clear(t,e){this.ctx.clearRect(0,0,t,e)}}const C={name:"山田　太郎",nameEn:"Taro Yamada",title:"Senior Software Engineer",tagline:"Building the future, one line at a time.",company:"Tech Solutions Inc.",email:"taro.yamada@example.com",phone:"+81-90-0000-0000",sns:"https://example.com/taroy",website:"https://www.example.com/"},R={ballSpeed:10,ballRadius:12,paddleSpeed:12,paddleWidthRatio:.4,paddleHeight:4,gravity:0,friction:1,blockRecoveryTime:1e4,effectDuration:5e3,destructionRadius:30},Y="standard",G={company:"#60A5FA",tagline:"#C084FC",name:"#F16584",nameEn:"#34D399",title:"#A78BFA",email:"#4ECDC4",phone:"#FB923C",sns:"#EC4899",website:"#FBBF24"};class N{constructor(t,e){p(this,"canvas");p(this,"config");p(this,"ball");p(this,"paddle");p(this,"blockManager");p(this,"particleSystem");p(this,"renderer");p(this,"gameRunning",!1);p(this,"gamePaused",!1);p(this,"gameOver",!1);p(this,"gameCleared",!1);p(this,"score",0);p(this,"animationFrameId",null);p(this,"lastTime",0);p(this,"frameCount",0);p(this,"lastFpsUpdate",0);p(this,"currentFps",0);p(this,"pointerX",0);p(this,"lastPointerMoveTime",0);p(this,"gameLoop",()=>{const t=performance.now(),e=t-this.lastTime;this.lastTime=t;const i=performance.now();this.gamePaused||this.update(t);const s=performance.now()-i,a=performance.now();this.render();const n=performance.now()-a;this.frameCount++,t-this.lastFpsUpdate>=1e3&&(this.currentFps=Math.round(this.frameCount*1e3/(t-this.lastFpsUpdate)),console.log(`FPS: ${this.currentFps} | Update: ${s.toFixed(2)}ms | Render: ${n.toFixed(2)}ms | Frame Time: ${e.toFixed(2)}ms `),this.frameCount=0,this.lastFpsUpdate=t),this.gamePaused||this.update(t),this.render(),this.gameRunning&&!this.gameOver&&!this.gameCleared&&(this.animationFrameId=requestAnimationFrame(this.gameLoop))});this.canvas=t;const i=(e==null?void 0:e.width)||t.width,s=(e==null?void 0:e.height)||t.height,a=(e==null?void 0:e.paddleWidthRatio)||.4,n=Math.floor(i*a);this.config={width:i,height:s,paddleSpeed:12,ballSpeed:10,ballRadius:12,paddleHeight:4,paddleWidthRatio:a,paddleWidth:n,gravity:0,friction:1,blockRecoveryTime:1e4,effectDuration:5e3,destructionRadius:30,dpr:1,...e};const o=this.config.dpr||1;console.log("GameEngine.tsのdpr:",o),this.ball=new W(this.config.width/2,this.config.height/2,this.config.ballRadius,this.config.ballSpeed),this.paddle=new L(this.config.width/2-this.config.paddleWidth/2,this.config.height-this.config.paddleHeight-1,this.config.paddleWidth,this.config.paddleHeight,this.config.paddleSpeed),this.blockManager=new O(this.config.blockRecoveryTime,this.config.effectDuration,o,G),this.particleSystem=new I,this.renderer=new $(t,o),this.setupEventListeners()}setupEventListeners(){this.canvas.addEventListener("mousemove",t=>{const e=this.canvas.getBoundingClientRect();this.pointerX=t.clientX-e.left,this.lastPointerMoveTime=performance.now()}),this.canvas.addEventListener("touchmove",t=>{const e=this.canvas.getBoundingClientRect();this.pointerX=t.touches[0].clientX-e.left,this.lastPointerMoveTime=performance.now()}),this.canvas.addEventListener("click",()=>{!this.gameRunning&&!this.gameOver&&!this.gameCleared?this.start():(this.gameOver||this.gameCleared)&&this.restart()}),this.canvas.addEventListener("touchstart",t=>{t.preventDefault(),!this.gameRunning&&!this.gameOver&&!this.gameCleared?this.start():(this.gameOver||this.gameCleared)&&this.restart()}),window.addEventListener("keydown",t=>{(t.key==="r"||t.key==="R")&&(this.gameOver||this.gameCleared)&&this.restart(),t.key===" "&&(!this.gameRunning&&!this.gameOver&&!this.gameCleared?this.start():this.gameRunning&&this.togglePause())}),this.canvas.addEventListener("click",()=>{!this.gameRunning&&!this.gameOver&&!this.gameCleared&&this.start()})}isPointerActive(){return performance.now()-this.lastPointerMoveTime<500}initializeWithBusinessCard(t,e="standard"){console.log("initializeWithBusinessCard called:",{layout:e,stackTrace:new Error().stack}),this.blockManager.createBlocksFromBusinessCard(t,this.config.width,this.config.height,1,e),this.resetGameState()}start(){if(this.gameRunning)return;this.gameRunning=!0,this.gamePaused=!1;const t=(Math.random()-.5)*Math.PI/2;this.ball.setVelocity(Math.cos(t)*this.config.ballSpeed,-Math.abs(Math.sin(t)*this.config.ballSpeed)),this.lastTime=performance.now(),this.lastFpsUpdate=this.lastTime,this.frameCount=0,this.gameLoop()}togglePause(){this.gamePaused=!this.gamePaused}restart(){this.resetGameState(),this.blockManager.reset(),this.score=0,this.gameRunning=!1,this.gamePaused=!1,this.gameOver=!1,this.gameCleared=!1,this.particleSystem.clear(),this.render()}resetGameState(){const t=this.config.width-50;this.ball.reset(t,50),this.paddle.reset(this.config.width/2-this.config.paddleWidth/2,this.config.height-this.config.paddleHeight-1)}update(t){this.paddle.update(this.config.width,this.config.paddleSpeed),this.isPointerActive()&&!this.paddle.isKeyboardActive()&&this.paddle.updateFromPointer(this.pointerX,this.config.width),this.ball.update(),this.ball.checkWallCollision(this.config.width,this.config.height),this.ball.checkPaddleCollision(this.paddle.getPaddle().x,this.paddle.getPaddle().y,this.paddle.getPaddle().width,this.paddle.getPaddle().height),this.blockManager.updateBlockRecovery(t);const e=this.blockManager.checkCollision(this.ball.getBall().x,this.ball.getBall().y,this.ball.getBall().radius);if(e!==-1){const i=this.blockManager.getBlocks()[e];i.isDestroyed||(this.blockManager.destroyBlock(e,t),this.particleSystem.createBlockDestructionEffect(i.x+i.width/2,i.y+i.height/2,i.color,15),this.score+=10,this.destroyNearbyBlocks(this.ball.getBall().x,this.ball.getBall().y,this.ball.getBall().radius*.5,t),this.ball.checkBlockCollision(i.x,i.y,i.width,i.height).collided&&this.particleSystem.createImpactEffect(this.ball.getBall().x,this.ball.getBall().y,i.color,8))}this.particleSystem.update(),this.ball.getBall().y>this.config.height+50&&(this.gameOver=!0,this.gameRunning=!1),this.blockManager.allBlocksDestroyed()&&(this.gameCleared=!0,this.gameRunning=!1)}destroyNearbyBlocks(t,e,i,s){this.blockManager.getBlocks().forEach((n,o)=>{if(n.isDestroyed)return;const h=n.x+n.width/2,u=n.y+n.height/2,l=h-t,c=u-e;Math.sqrt(l*l+c*c)<i*2&&(this.blockManager.destroyBlock(o,s),Math.random()<.3&&this.particleSystem.createBlockDestructionEffect(h,u,n.color,3),this.score+=5)})}render(){this.renderer.clear(this.config.width,this.config.height),this.renderer.drawBackground(this.config.width,this.config.height);const t=performance.now();this.renderer.drawBlocks(this.blockManager.getBlocks(),t,this.blockManager),this.renderer.drawBall(this.ball.getBall()),this.renderer.drawPaddle(this.paddle.getPaddle()),this.renderer.drawParticles(this.particleSystem.getParticles()),this.renderer.drawScore(this.score),this.gameOver?this.renderer.drawGameOver(this.config.width,this.config.height):this.gameCleared&&this.renderer.drawGameClear(this.config.width,this.config.height,this.score)}stop(){this.gameRunning=!1,this.animationFrameId!==null&&cancelAnimationFrame(this.animationFrameId)}getScore(){return this.score}getGameState(){return{running:this.gameRunning,paused:this.gamePaused,gameOver:this.gameOver,cleared:this.gameCleared}}}function X(x,t,e,i="standard",s=!1){const a=document.getElementById(x);if(!a)throw new Error(`Container with ID "${x}" not found`);const n=91/55,o=320,h=910;let u=a.clientWidth||600;u=Math.max(o,Math.min(h,u));let l=u,c=u/n;(!a.style.height||a.style.height==="0px")&&(a.style.height=`${c}px`),l=Math.floor(l/8)*8,c=Math.floor(c/8)*8;const F=window.devicePixelRatio||1,b=Math.floor(l*F/8)*8,f=Math.floor(c*F/8)*8,r=document.createElement("canvas");r.width=b,r.height=f,r.style.width=`${l}px`,r.style.height=`${c}px`,r.style.display="block",r.style.backgroundColor="#1a1a2e",r.style.borderRadius="8px",r.style.boxShadow="0 4px 6px rgba(0, 0, 0, 0.3)",r.style.margin="0 auto",a.appendChild(r);const d={...R,...e,width:l,height:c,dpr:F};console.log("index.tsのdpr:",F);const g=new N(r,d),y={...C,...t};return g.initializeWithBusinessCard(y,i),s&&g.start(),g}let T=null;const K=()=>{document.getElementById("nameInput").value=C.name,document.getElementById("nameEnInput").value=C.nameEn,document.getElementById("titleInput").value=C.title,document.getElementById("taglineInput").value=C.tagline,document.getElementById("companyInput").value=C.company,document.getElementById("emailInput").value=C.email,document.getElementById("phoneInput").value=C.phone,document.getElementById("snsInput").value=C.sns,document.getElementById("websiteInput").value=C.website,document.getElementById("layoutSelect").value=Y},k=()=>({name:document.getElementById("nameInput").value,nameEn:document.getElementById("nameEnInput").value,title:document.getElementById("titleInput").value,tagline:document.getElementById("taglineInput").value,company:document.getElementById("companyInput").value,email:document.getElementById("emailInput").value,phone:document.getElementById("phoneInput").value,sns:document.getElementById("snsInput").value,website:document.getElementById("websiteInput").value}),A=(x,t)=>{const e=document.getElementById("gameContainer");e.innerHTML="",T=X("gameContainer",x,R,t,!1),T.start()};window.startGame=function(){const x=k(),t=document.getElementById("layoutSelect").value;T&&T.stop(),A(x,t)};window.addEventListener("load",()=>{K();const x=k(),t=document.getElementById("layoutSelect").value;A(x,t)});
